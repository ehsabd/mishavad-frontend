!function(angular){document.documentElement.setAttribute("data-useragent",navigator.userAgent),angular.module("app",["app.templates","editCampaignModule","campaignDetailsModule","campaignResourceModule","app.contribute","ngResource","ngCookies","ngRoute","ngAnimate","ngSanitize","ngTouch","ngMessages","ui.bootstrap","dynamicNumber","readableTimeFa","iPersian"]).config(["dynamicNumberStrategyProvider",function(dynamicNumberStrategyProvider){dynamicNumberStrategyProvider.addStrategy("price",{numInt:12,numFract:0,numSep:".",numPos:!0,numNeg:!1,numRound:"round",numThousand:!0,numThousandSep:","})}]).directive("mshScrollyAfter",["$window",function($window){return{restrict:"A",link:function(scope,element,attrs){angular.element($window).bind("scroll",function(){0<$window.scrollY-element[0].clientHeight||document.documentElement.clientWidth<=768?scope.$apply(function(){scope.scrollyAfter=!0}):scope.$apply(function(){scope.scrollyAfter=!1})})}}}]).directive("mshClientWidth",["$timeout","$window",function($timeout,$window){return{restrict:"A",scope:{ngClientWidth:"="},link:{post:function(scope,elm){scope.$watch(function(){return elm[0].clientWidth},function(newValue){$timeout(function(){scope.$apply(function(scope){scope.ngClientWidth=newValue})})})}}}}]).directive("mshShowLoadedImg",[function(){return{restrict:"A",link:function(scope,elm){var img=elm;img.css({opacity:0}),img.bind("load",function(){img.css({opacity:1}),console.log("img is loaded")})}}}]).directive("mshLogo",[function(){return{templateUrl:"app/components/shared/logoTemplate"}}]).directive("mshFooter",[function(){return{templateUrl:"app/components/shared/footerTemplate"}}]).directive("mshNavigation",[function(){return{templateUrl:"app/components/shared/navTemplate"}}]).controller("MainController",["$scope","$route","$routeParams","$location","$uibModal","$cookies","$http","$interval","constantsUtils",function($scope,$route,$routeParams,$location,$uibModal,$cookies,$http,$interval,constantsUtils){$scope.$route=$route,$scope.$location=$location,$scope.$routeParams=$routeParams,$scope.currentClass=function(){return"view "+$scope.$location.path().substr(1).replace(/\//g,"-")},$scope.checkCookies=function(){$scope.isLoggedIn=!1;var token=$cookies.getObject("tokenData");null!=token&&(Date.parse(token[".expires"])-(new Date).getTime()<6e5?$cookies.remove("tokenData"):($scope.isLoggedIn=!0,$scope.access_token=token.access_token,$http({method:"GET",url:constantsUtils.API_V1_URL+"/account/Fullname",headers:{Authorization:"Bearer "+token.access_token},responseType:"text"}).then(function(response){$scope.fullname=response.data,console.log($scope.fullname)},function(response){console.log(response),$scope.logout()})))},$scope.$watch("isLoggedIn",function(){$scope.isLoggedIn}),$scope.$on("TitleUpdatedEvent",function(newTitle){$scope.pageTitle=newTitle}),$scope.$on("AuthFailedEvent",function(){$route.reload()}),$scope.openLogin=function(){$scope.isLoggedIn||($scope.beforeModalOpen=!0,$location.state("login"),$uibModal.open({animation:!0,templateUrl:"app/components/account/loginView",controller:"LoginController"}).result.then(function(tokenData){$scope.beforeModalOpen=!1,$cookies.putObject("tokenData",tokenData.data),console.log($cookies.getObject("tokenData")),$scope.checkCookies(),$location.state(null)},function(){$scope.beforeModalOpen=!1,$location.state(null)}))},$scope.openRegister=function(){$scope.beforeModalOpen=!0,$location.state("register"),$uibModal.open({animation:!0,templateUrl:"app/components/account/registerView",controller:"RegisterController",resolve:{redirectUrl:function(){return $location.protocol()+"://"+$location.host()+"/#/account/email-confirmed"}}}).result.then(function(){$scope.beforeModalOpen=!1,$location.state(null)},function(){$scope.beforeModalOpen=!1,$location.state(null)})},$scope.logout=function(){$cookies.remove("tokenData"),$scope.isLoggedIn=!1,delete $scope.token,delete $scope.access_token,delete $scope.fullname},$scope.$on("SlideShowOpenedEvent",function(){$scope.isSlideShowOpen=!0}),$scope.$on("SlideShowClosedEvent",function(){$scope.isSlideShowOpen=!1}),$scope.checkCookies()}]),angular.module("app.templates",[]).run(["$templateCache",function($templateCache){$templateCache.put("app/components/account/accountView",'<div class="well" ng-if="!isLoggedIn"><p>این صفحه اعضاء است شما هنوز عضو نشده اید</p><a ng-click="">همین حالا در می شود عضو شوید</a></div><div ng-if="isLoggedIn" class="container"><div class="row user-name"><h2>{{userinfo.firstName + \' \' + userinfo.lastName}}</h2></div><uib-tabset><uib-tab index="0" heading="کمپین ها"><h3>کمپین های ایجاد شده توسط من</h3><div class="row user-campaign" ng-repeat="camp in userCampaigns"><div class="col-sm-4"><h4><a href="{{\'/campaigns/\' + camp.id+\'/edit\'}}" ng-bind="camp.title"></a></h4><a><div class="user-camp-img"><img class="img-responsive" ng-src="{{camp.thumbnail || \'/FrontEnd/assets/img/default-thumbnail.png\'}}"></div></a></div><div class="col-sm-4">{{camp.tagline}}</div><div class="col-sm-4 controls"><span ng-repeat="s in camp.status" class="label label-default status" ng-class="s.toLowerCase()" ng-bind="(\'_ui_key_Status\'+s) | xlat"></span><div ng-if="!camp.isApproved"><a class="btn btn-danger btn-remove" ng-click="showRemoveBox=true">حذف کمپین <i class="fa fa-trash" aria-hidden="true"></i></a><div class="remove-box" ng-show="showRemoveBox"><p>آیا برای حذف کمپین <strong>\'{{camp.title}}\'</strong> مطمئن هستید</p><a class="btn btn-danger" ng-click="removeCampaign($index)">بلی</a> <a class="btn btn-default" ng-click="showRemoveBox=false">خیر</a></div></div></div></div></uib-tab></uib-tabset></div>'),$templateCache.put("app/components/account/emailconfirmedView",'<div class="well"><p>ایمیل شما مورد تأیید قرار گرفت</p><p ng-show="!isLoggedIn">برای وارد شدن به حساب کاربری خود <a ng-click="openLogin();">اینجا کلیک کنید</a></p></div>'),$templateCache.put("app/components/account/loginView",'<form><div class="modal-header"><h3 class="modal-title">ورود به حساب کاربری</h3></div><div class="modal-body"><div class="login-wrapper container-fluid"><div class="form-group"><label>{{\'_ui_key_Email\' | xlat}}</label><div class="right-inner-addon"><i class="fa fa-envelope" aria-hidden="true"></i> <input type="text" class="form-control" ng-model="loginEmail" placeholder="Email" value=""></div></div><div class="form-group"><label>{{\'_ui_key_Password\' | xlat}}</label> <input type="password" class="form-control" ng-model="loginPassword" placeholder="Password"></div><div uib-alert="" class="alert-danger" ng-bind="alertMessage | xlat" ng-if="showAlert"></div></div></div><div class="modal-footer"><button class="login-btn btn btn-default btn-bez btn-bez-md" type="submit" ng-class="{\'waiting\': isWaiting}" ng-click="submitLogin()">{{\'_ui_key_LogIn\' | xlat}}</button></div></form>'),$templateCache.put("app/components/account/registerView",'<form><div class="modal-header"><h3 class="modal-title" ng-bind-html="\'_ui_key_RegisterTitle\' | xlat"></h3></div><div class="modal-body"><div class="register-wrapper container-fluid"><div class="register-input-form" ng-show="!showSuccess"><div class="row"><div class="col-md-6 form-group"><label>{{\'_ui_key_FirstName\' | xlat}}</label> <input type="text" class="form-control" ng-model="registerModel.firstName"></div><div class="col-md-6 form-group"><label>{{\'_ui_key_LastName\' | xlat}}</label> <input type="text" class="form-control" ng-model="registerModel.lastName"></div></div><div class="form-group"><label>{{\'_ui_key_Email\' | xlat}}</label><div class="right-inner-addon"><i class="fa fa-envelope" aria-hidden="true"></i> <input type="text" class="form-control" ng-model="registerModel.email" placeholder="Email" value=""></div></div><div class="form-group"><label>{{\'_ui_key_Password\' | xlat}}</label> <input type="password" class="form-control" ng-model="registerModel.password" placeholder="Password"></div><div class="form-group"><label>{{\'_ui_key_ConfirmPassword\' | xlat}}</label> <input type="password" class="form-control" ng-model="registerModel.confirmPassword" placeholder="Password"></div></div><div uib-alert="" ng-repeat="alert in alerts" ng-class="\'alert-\' + alert.type" close="closeAlert($index)" ng-bind-html="alert.msg | xlat"></div></div></div><div class="modal-footer"><button class="register-btn btn btn-default btn-bez btn-bez-sm" type="submit" ng-show="!showSuccess" ng-class="{\'waiting\': isWaiting}" ng-click="submitRegister()">{{\'_ui_key_Register\' | xlat}}</button></div></form>'),$templateCache.put("app/components/home/aboutView",'<div id="about-page" class="container"><p></p><h2>می شود چه کار می کند؟</h2><p>می شود یک سامانه <strong>حمایت مالی جمعی</strong> یا کراودفاندینگ (Crowdfunding) است که بر افزایش روحیه کارآفرینی و امید در مبتکرین ایرانی تأکید دارد. می شود فرصتی را فراهم می آورد تا کاربرانش با مرور پروژه های مختلفی که پروژه آفرینان در آن ارائه می کنند، از پروژه هایی که فکر می کنند می توانند برای کسب و کار ایرانی مفید باشند حمایت کنند</p><h2>نقش کاربران می شود چیست؟</h2><p>کاربران می شود تنها نقش حمایت مالی از پروژه های پست شده در وبسایت را ندارند. آن ها با انتخاب پروژه هایی که به نظر آن ها مفید، کاربردی، قابل اجرا، یا جذاب هستند نوعی دموکراسی کسب و کار به وجود می آورند. و قبل از اینکه مجریان پروژه ها به اجرای کارهای خود بپردازند فرصتی را برای آن ها فراهم می آورند که مردم از چه چیزهایی خوششان می آید و آن ها چه چیزهایی را جذاب می دانند. و این یک نوع آمایش بازار قبل از اقدام به تولید است.</p><p></p></div>'),$templateCache.put("app/components/home/carouselView",'<script type="text/ng-template" id="customTemplate.html"><div class="carousel-inner" ng-transclude></div> <a role="button" href class="left carousel-control" ng-click="prev()" ng-class="{ disabled: isPrevDisabled() }" ng-show="slides.length > 1"> <i class="fa fa-chevron-circle-left" aria-hidden="true"></i> <span class="sr-only">previous</span> </a> <a role="button" href class="right carousel-control" ng-click="next()" ng-class="{ disabled: isNextDisabled() }" ng-show="slides.length > 1"> <i class="fa fa-chevron-circle-right" aria-hidden="true"></i> <span class="sr-only">next</span> </a> <ol class="carousel-indicators" ng-show="slides.length > 1"> <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index" ng-class="{ active: isActive(slide) }" ng-click="select(slide)"> <span class="sr-only">slide {{ $index + 1 }} of {{ slides.length }}<span ng-if="isActive(slide)">, currently active</span></span> </li> </ol><\/script><div style="height: 305px; overflow: hidden;"><div uib-carousel="" active="1" interval="interval" no-wrap="" template-url="customTemplate.html"><div uib-slide="" ng-repeat="slide in slides track by slide.id" index="slide.id"><img ng-src="{{slide.image}}" style="margin:auto"><div class="carousel-caption"><div ng-bind-html="slide.html | xlat" ng-style="{\'color\': slide.textColor, \'background\': slide.backColor}"></div></div></div></div></div>'),$templateCache.put("app/components/home/gridGalleryView",'<div id="grid-gallery" class="row grid-gallery" ng-class="{\'slideshow-open\' : slideShow.open}"><section class="grid-wrap"><ul class="grid"><li class="grid-sizer"></li><li ng-repeat="camp in campaigns" class="campaign-tile"><figure ng-click="openSlideShow($index)"><div ng-if="camp.thumbnail" style="height:200px; overflow:hidden;"><img msh-show-loaded-img="" class="img-responsive" ng-src="{{camp.thumbnail}}" alt="Campaign Thumbnail Image"></div><figcaption><div id="campaign_{{camp.id}}"><div class="primary"><h2 class="campaign-title row">{{camp.title}}</h2><div class="tagline"><p>{{camp.tagline}}</p></div><div class="campaign-tags row" style="padding-bottom:5px"><span class="col-xs-6 category text-center">{{camp.category}}</span> <span class="col-xs-6 stage text-center">{{camp.projectStage}}</span></div><div class="progress-container"><div class="row"><div class="collected-wrap col-xs-6"><div class="collected-fund"><p ng-bind-html="\'_ui_key_CollectedFundOnly\'|xlat:({\'collectedFund\':(camp.collectedFund | awnum:\'price\')})"></p></div></div><div class="progress-wrap"><uib-progressbar class="active" value="camp.collectedFundPercent">{{camp.collectedFundPercent}}%</uib-progressbar></div></div><div class="row"><div class="time-left"><i class="fa" ng-class="getHourglass(camp)" aria-hidden="true"></i> <span ng-bind-html="\'_ui_key_TimeLeft\' | xlat:({\'readableTimeLeft\':(camp.totalSecondsLeft | readableTimeFa)})"></span></div></div></div></div></div></figcaption></figure></li></ul></section><section class="slideshow" ng-swipe-right="prevSlide()" ng-swipe-left="nextSlide()"><ul class="animatable"><li cbp-grid-gallery-repeat="" ng-repeat="camp in campaigns" id="slide_{{$index}}" ng-class="{\'current show\':slideShow.currentIndex==$index, \'show\': ($index==slideShow.currentIndex-1) || ($index==slideShow.currentIndex+1)}"><figure><h3 class="camp-title">{{camp.title}} <a href="/campaigns/{{camp.id}}" class="btn btn-camp-page">صفحه اختصاصی کمپین</a> <a href="/campaigns/{{camp.id}}/contribute" class="btn-msh btn" ng-bind="\'_ui_key_Contribute\'|xlat"></a></h3><div ng-show="camp.thumbnail" class="camp-img-wrapper"><img class="img-responsive camp-img" ng-src="{{camp.thumbnail}}" alt="{{camp.title}}"></div><div campaign="camp" campaign-tabs="" fixed-height="true" campaign-rewards="currentCampaignRewards" active="slideShow.activeTabIndex"></div></figure></li></ul><nav><span class="icon nav-prev" ng-click="prevSlide()" ng-show="slideShow.currentIndex > 0"></span> <span class="icon nav-next" ng-click="nextSlide()" ng-show="slideShow.currentIndex < campaigns.length - 1"></span> <span class="icon nav-close" ng-click="closeSlideShow()"></span></nav></section></div>'),$templateCache.put("app/components/home/homeView",'<div ng-class="{\'slideshow-open\':isSlideShowOpen}"><div class="first-section create-camp-landing container-fluid"><div class="row"><div class="col-xs-12 create-camp-wrap"><ul class="fa-ul"><li>اهل نوآوری و خلاقیت هستین؟<i class="fa fa-square"></i></li><li>می خواین یه محصول جالب تولید کنین؟<i class="fa fa-square"></i></li><li>برای حمایت از محیط زیست ایده دارین؟<i class="fa fa-square"></i></li><li>فکری دارید که می تونه به سلامت جامعه کمک کنه یا درد بیماران رو کم کنه؟<i class="fa fa-square"></i></li><li>می خواین اپلیکیشن یا وبسایت بسازید اما سرمایه ندارین؟<i class="fa fa-square"></i></li></ul><div class="text-center"><a href="/create-campaign" class="btn btn-default create-campaign" ng-bind-html="\'_ui_key_CreateCampaignBanner\' | xlat"></a><p ng-bind="\'_ui_key_BavarKonidMishavad\' | xlat"></p></div></div></div></div><div id="campaigns" class="second-section"><div id="active-campaigns"><div cbp-grid-gallery="" campaigns="campaigns" on-close="$emit(\'SlideShowClosedEvent\')" on-open="$emit(\'SlideShowOpenedEvent\')"></div><button class="btn btn-inverse" ng-if="nextPageLink" ng-click="loadNextPage()">نمایش بیشتر ...</button></div></div><div class="third-section text-center"><p>سایت یا وبلاگ دارید؟ می خواید پیام می شود رو به دیگران برسونید؟</p></div></div>'),$templateCache.put("app/components/shared/footerTemplate",'<div class="footer-right"><div class="logo footer-logo"></div><p class="footer-links"><a href="/home">خانه</a> · <a href="/">بلاگ می شود</a> · <a href="/about">درباره ما</a> · <a href="/">پرسش و پاسخ</a> · <a href="/">تماس با ما</a></p><p class="footer-company-name">می شود &copy; 2015</p></div><div class="footer-center"><div><i class="fa fa-map-marker"></i><p><span>خیابان رویاها، کوچه تلاش، پلاک موفقیت</span> یک نقطه از ایران</p></div><div><i class="fa fa-phone"></i><p>+9800000000000</p></div><div><i class="fa fa-envelope"></i><p><a href="mailto:support@company.com">support@mishavad.ir</a></p></div></div><div class="footer-left"><p class="footer-company-about"><span>چرا نشه؟ میشه خوبم میشه!</span> می شود یک پلتفرم کراودفاندینگه که خیلی ساده می خواد بگه می شود</p><div class="footer-icons"><a href="/"><i class="fa fa-facebook"></i></a> <a href="/"><i class="fa fa-twitter"></i></a> <a href="/"><i class="fa fa-linkedin"></i></a> <a href="/"><i class="fa fa-github"></i></a></div></div>'),$templateCache.put("app/components/shared/logoTemplate",'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" id="svg2" height="200" width="350"><path id="path3760" d="m 283.13284,83.53728 c -17.295,5e-5 -26.19,10.216 -26.686,30.65 -0.16526,7.0502 -0.46758,10.852 -0.90821,11.402 -1.4321,1.6524 -6.3619,2.4785 -14.789,2.4785 l -40.197,0 -12.68,14.871 c 9.8592,0 15.615,0.0828 17.268,0.24804 9.088,0.71603 13.633,2.6706 13.633,5.8652 -8e-5,5.2325 -1.818,9.3651 -5.4531,12.395 -3.415,2.809 -7.7671,4.2129 -13.055,4.2129 l -19.084,0 c -7.2705,-2e-5 -13.192,-1.8448 -17.764,-5.5352 -4.9572,-4.0208 -7.4356,-9.5842 -7.4356,-16.689 l 0,-32.305 -14.871,18 0,8.6035 c -1e-5,12.062 3.0561,22.032 9.1699,29.908 6.7197,8.5924 15.946,12.889 27.678,12.889 l 22.887,0 c 8.7576,-4e-5 16.329,-2.8366 22.719,-8.5098 6.5544,-5.8935 9.8319,-13.163 9.832,-21.811 l -0.74414,-7.2715 8.0976,0 5.7012,0 0,-0.22461 c 8.9852,-0.48299 15.51,-1.5863 19.498,-3.3281 4.847,3.7454 10.437,5.6191 16.771,5.6191 8.317,0 14.789,-3.0022 19.416,-9.0059 4.2411,-5.4529 6.3613,-12.449 6.3613,-20.986 -6e-5,-8.5924 -2.0105,-15.779 -6.0312,-21.562 -4.6267,-6.6095 -11.072,-9.914 -19.334,-9.9141 z m -0.41211,14.541 c 8.5373,4e-5 12.807,5.3689 12.807,16.109 -6e-5,10.685 -4.2694,16.029 -12.807,16.029 -8.7026,2e-5 -13.055,-5.1513 -13.055,-15.451 -3e-5,-11.126 4.3521,-16.687 13.055,-16.688 z" inkscape:connector-curvature="0"></path><path id="path4711" d="m 221.82284,23.717278 c -8e-5,2.6439 -0.93643,4.8195 -2.809,6.5269 -1.8728,1.7076 -4.1035,2.5613 -6.6922,2.5612 -2.754,8e-5 -5.15,-0.82611 -7.1879,-2.4786 -2.2032,-1.7625 -3.3048,-3.9656 -3.3048,-6.6095 -6e-5,-5.3426 3.167,-8.014 9.5012,-8.0141 6.995,1e-4 10.493,2.6714 10.493,8.0141 z" inkscape:connector-curvature="0"></path><path id="path4709" d="m 236.36284,44.707278 c -9e-5,2.6439 -0.92267,4.8333 -2.7677,6.568202 -1.8452,1.7351 -4.0897,2.6026 -6.7335,2.6025 -2.754,6e-5 -5.1776,-0.85367 -7.2705,-2.5612 -2.0931,-1.707402 -3.1396,-3.910602 -3.1395,-6.609502 -7e-5,-5.2876 3.1119,-7.9314 9.336,-7.9314 7.0501,8e-5 10.575,2.6439 10.575,7.9314 z" inkscape:connector-curvature="0"></path><path id="path4707" d="m 207.61284,44.707278 c -6e-5,2.5337 -0.92264,4.6956 -2.7677,6.485602 -1.8452,1.7901 -4.0346,2.6852 -6.5682,2.6851 -2.8091,6e-5 -5.2326,-0.85367 -7.2705,-2.5612 -2.038,-1.707402 -3.057,-3.910602 -3.0569,-6.609502 -4e-5,-5.2876 3.167,-7.9314 9.5012,-7.9314 6.7747,8e-5 10.162,2.6439 10.162,7.9314 z" inkscape:connector-curvature="0"></path><path d="m 115.54675,51.39478 c -8.2621,0 -14.12766,1.48674 -17.597657,4.46094 -6.0037,5.012 -9.005869,13.7434 -9.005859,26.1914 0,11.402 3.772459,19.30454 11.318356,23.71094 5.783,3.3599 14.81661,5.04102 27.09961,5.04102 -0.2754,6.9946 -2.75385,12.52957 -7.43554,16.60547 -4.682,4.0758 -10.54756,6.11328 -17.59766,6.11328 l -2.753907,0 -13.935547,14.87109 19.167974,0 c 10.961,0 20.08861,-3.53949 27.38671,-10.61719 7.29658,-7.07672 10.94589,-16.06541 10.94727,-26.96875 l 17.21484,0 c 6.389,0 12.91743,-3.47015 19.58203,-10.41015 6.334,7.8214 13.08179,11.73242 20.24219,11.73242 6.334,0 12.36545,-3.30457 18.09375,-9.91407 5.784,6.7202 12.61383,10.08008 20.49023,10.08008 6.8849,0 12.17093,-2.58812 15.86133,-7.76562 3.3047,-4.572 4.95692,-10.43726 4.95703,-17.59766 l 0,-22.80469 -14.54101,10 0,14.70313 c 0,6.169 -3.47026,9.25393 -10.41016,9.25391 -3.5802,0 -6.60939,-1.12842 -9.08789,-3.38672 -2.4787,-2.2582 -3.71883,-5.15068 -3.71875,-8.67578 l 0,-21.89454 -14.45703,10 0,14.70313 c 0,6.169 -3.49914,9.25393 -10.49414,9.25391 -3.5802,0 -6.58246,-1.11501 -9.00586,-3.34571 -2.4235,-2.2307 -3.6348,-5.13659 -3.63477,-8.71679 l 0,-21.89454 -14.62304,8.08399 0,12.90234 c 0,7.2153 -3.44323,10.82229 -10.32813,10.82227 l -6.30859,0 0,-0.004 -9.83203,0 c -0.2204,-14.156 -1.48553,-24.09787 -3.79883,-29.82617 -4.021,-9.8039 -11.95292,-14.70698 -23.79492,-14.70703 z m 0,14.70508 c 3.9657,10e-5 7.07763,1.68121 9.33593,5.04101 1.98281,2.9744 2.97455,6.52731 2.97461,10.65821 l 0,14.12695 c -7.71089,1e-4 -12.97224,-0.49684 -15.78124,-1.48828 -5.2326,-1.762 -7.84769,-5.78145 -7.84766,-12.06055 0,-5.3426 0.57768,-9.17097 1.73438,-11.48437 1.6523,-3.1946 4.84708,-4.79293 9.58398,-4.79297 z" id="path3764" inkscape:connector-curvature="0"></path><path id="path3766" d="m 89.122843,71.38728 c -8e-5,5.9486 -2.2308,10.74 -6.6922,14.376 -4.131,3.3598 -9.2259,5.0398 -15.285,5.0398 l -46.102,0 9.9345,-14.871 35.176,0 c 5.5079,0 8.2619,-1.9278 8.2619,-5.7833 -6e-5,-1.9828 -0.74364,-3.7729 -2.2307,-5.3702 l -25.461,-27.609002 1.9969,-18.08 33.461,35.444002 c 4.6266,4.9021 6.9399,10.52 6.94,16.854 z" inkscape:connector-curvature="0"></path></svg>'),$templateCache.put("app/components/shared/navTemplate",'<div class="container-fluid"><div class="row"><div class="col-sm-2 logo-wrap"><button type="button" class="navbar-toggle" ng-click="isNavCollapsed = !isNavCollapsed"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div msh-logo="" class="header-logo" ng-class="{\'nav-open\':!isNavCollapsed}"></div></div><div class="col-sm-10 nav-wrap collapse navbar-collapse" uib-collapse="isNavCollapsed" ng-click="isNavCollapsed = true"><div class="row"><div class="col-md-5 nav-account-wrap"><ul class="nav navbar-nav navbar-left" ng-cloak=""><li ng-hide="isLoggedIn"><a href="" ng-click="openRegister()">ثبت نام <i class="fa fa-user-plus"></i></a></li><li ng-hide="isLoggedIn"><a href="" ng-click="openLogin();">ورود به حساب کاربری</a></li><li ng-show="isLoggedIn"><a href="/account" class="hello-user" ng-bind-template="سلام {{fullname}}!"></a></li><li ng-show="isLoggedIn"><a href="" ng-click="logout();">خروج</a></li></ul></div><div class="col-md-7"><ul class="nav navbar-nav navbar-left"><li><a href="/home">خانه</a></li><li><a href="/about">درباره می شود</a></li><li><a href="/contact">تماس با ما</a></li><li><a href="/create-campaign" class="btn btn-success create-campaign" ng-bind-html="\'_ui_key_CreateCampaignBanner\' | xlat"></a></li></ul></div></div></div></div></div>'),$templateCache.put("app/components/campaign/contribute/contributeView",'<div id="contribute-page" class="container" ng-show="campaignRewards"><div class="row page-header"><h2>حمایت از کمپین</h2><p ng-bind-html="\'_ui_key_ContributeStepsNote\' | xlat"></p></div><div class="steps-container"><div class="row step"><span class="stepnumber"></span> <span class="dummy"></span><h3>دوست دارید پروژه آفرین چگونه از شما تشکر کند؟</h3><div class="rewards-container"><div class="reward-wrap col-sm-3 col-xs-6"><div class="no-reward" ng-click="selectReward(\'contribute-only\')" ng-class="{\'reward-selected\':contributeOnly}"><p>فقط می خواهم حمایت کنم</p><div class="row"><div class="form-group col-sm-10 amount" ng-show="contributeOnly"><label class="ng-binding">میزان حمایت</label> <input class="form-control" ng-model="giftFundAmount" placeholder="مبلغ بر حسب تومان" num-int="11" num-fract="0" num-thousand="true" awnum=""></div></div></div></div><div class="reward-wrap col-sm-3 col-xs-6" ng-click="selectReward($index)" ng-repeat="campaignReward in campaignRewards"><div ng-class="{\'reward-selected\': campaignReward.id==selectedRewardId}" class="reward" reward="campaignReward" reward-template="" show-reward-image="false"></div></div></div></div><div class="row step"><span class="stepnumber"></span> <span class="dummy"></span><h3>اگر کمپین موفق نشد؟!</h3><p class="condensed">در صورتی که کمپین موفق نشد ما کمک شما را به حساب شما در می شود باز می گردانیم. برای این کار لازم است <strong>ایمیل</strong> شما را داشته باشیم</p><div class="row"><div class="form-group col-lg-3 col-md-4 col-sm-6"><label>{{\'_ui_key_Email\' | xlat}}</label><div class="right-inner-addon"><i class="fa fa-envelope" aria-hidden="true"></i> <input type="text" class="form-control" ng-model="email" placeholder="Email" value=""></div></div></div><div class="form-group"><p>در صورتی که تمایل به بازگشت پول خود ندارید و نمی خواهید ایمیل خود را در اختیار قرار دهید ایمیل anon@mishavad.ir را در ایمیل وارد کنید. شما با وارد کردن این ایمیل شرایط مربوط به <strong>کمک کاملا گمنام</strong> را می پذیرید</p></div></div><div class="row step"><span class="stepnumber"></span> <span class="dummy"></span><h3>دوست دارید نام شما به عنوان حامی ثبت شود؟</h3><div credit-buttons="" class="btn-group btn-group-justified hidden-xs"></div><div credit-buttons="" class="btn-group-vertical visible-xs"></div><div class="contributer-name" ng-class="{\'expanded\': creditType==\'realname\' || creditType==\'nickname\'}"><div class="row realname" ng-if="creditType==\'realname\'"><div class="col-sm-4 col-xs-6 form-group"><label>{{\'_ui_key_FirstName\' | xlat}}</label> <input type="text" class="form-control" ng-model="firstName"></div><div class="col-sm-4 col-xs-6 form-group"><label>{{\'_ui_key_LastName\' | xlat}}</label> <input type="text" class="form-control" ng-model="lastName"></div></div><div class="row nickname" ng-if="creditType==\'nickname\'"><div class="form-group col-sm-4"><label>{{\'_ui_key_NickName\' | xlat}}</label><div class="right-inner-addon"><i class="fa fa-asterisk" aria-hidden="true"></i> <input type="text" class="form-control" ng-model="nickName" placeholder="" value=""></div></div></div></div></div><div class="row step payment"><span class="stepnumber"></span> <span class="dummy"></span><h3>پرداخت</h3><p>شیوه پرداخت را انتخاب کنید:</p><div payment-buttons="" class="btn-group btn-group-justified hidden-xs"></div><div payment-buttons="" class="btn-group-vertical visible-xs"></div><div class="col-sm-2 div-fade" ng-show="payMethod"><p class="visible-xs"></p><button class="pay-btn btn btn-submit" type="submit" ng-class="{\'waiting\': isWaiting}" ng-click="submitPay()">{{\'_ui_key_Payment\' | xlat}}</button></div></div></div></div>'),$templateCache.put("app/components/campaign/create/createCampaignView-OLD",'<div class="create-camp-login well" ng-if="isLoggedIn==false"><p ng-bind-html="\'_ui_key_CreateCampaignRegisterNotice\' | xlat"></p><p>همین حالا در سایت <a ng-click="openRegister();">عضو شوید</a> و اگر قبلا عضو شده اید به حساب کاربری خود <a ng-click="openLogin();">وارد شوید</a></p></div><div ng-if="isLoggedIn" class="container" ng-controller="CreateCampaignController"><form ng-show="!success" class="create-campaign"><div class="row page-header"><h2>کمپین خود را شروع کنید</h2><p>خلاقیت و کارآفرینی را با یک کمپین شروع کنید.</p></div><div class="row"><div class="form-group col-sm-4"><label ng-bind="\'_ui_key_CampaignTitle\' | xlat"></label> <input class="form-control" ng-model="campaign.title"></div><div class="col-sm-4 hint"><p>عنوان کمپین اولین چیزی است که به چشم می آید. در نگاه اول نظر مخاطبان را جلب کنید!</p></div></div><div class="row"><div class="form-group col-sm-4"><label ng-bind="\'_ui_key_TargetFund\' | xlat"></label> <input class="form-control" ng-model="campaign.targetFund" placeholder="مبلغ بر حسب تومان" num-int="11" num-fract="0" num-thousand="true" awnum=""></div><div class="col-sm-4 hint"><p>هزینه مورد نیاز کمپین خود را اینجا وارد کنید. نگران نباشید می توانید بعدا این اطلاعات را ویرایش کنید</p></div></div><div class="row"><div class="form-group col-sm-4"><label ng-bind="\'_ui_key_Tagline\' | xlat"></label> <textarea class="form-control" ng-model="campaign.tagline"></textarea></div><div class="col-sm-4 hint"><br><p>این جمله در صفحه اول *می شود* می آید. چیزی را درج کنید که شایسته صفحه اول باشد</p></div></div><div class="row"><div class="form-group col-sm-4"><button class="btn btn-success btn-bez btn-bez-sm" ng-class="{\'waiting\': isWaiting}" ng-click="createCampaign()" ng-bind-html="\'_ui_key_CreateCampaign\' | xlat"></button></div></div></form><div class="row"><div class="col-sm-4"><div uib-alert="" class="alert" ng-class="\'alert-\'.concat((success)?\'success\':\'danger\')" ng-show="showAlert">{{alertMessage}}</div></div></div></div>'),$templateCache.put("app/components/campaign/details/CampaignDetails.tpl",'<div id="camp-details" class="container" ng-show="campaign.id"><div class="row campaign-title"><h1>{{campaign.title}}</h1></div><div class="row campaign-loc-cat"><div class="col-sm-6"><div class="campaignHeaderBasics-location-name"><i class="fa fa-map-marker" aria-hidden="true"></i> {{campaign.city}}</div></div><div class="col-sm-6"><p class="campaignHeaderBasics-category-name">{{campaign.category}}</p></div></div><div class="row campaign-basics"><div class="col-sm-8"><img msh-show-loaded-img="" class="center-block img-responsive" ng-src="{{campaign.thumbnail}}" alt="Campaign Thumbnail Image"></div><div class="col-sm-4 campaign-stats"><div class="row collected-fund"><div class="progress-square" ng-style="getProgressStyle(campaign.collectedFundPercent)"><span class="text-center">{{campaign.collectedFundPercent}}%</span></div></div><div class="row"><div class="col-xs-6 collected-fund"><div><p ng-bind-html="\'_ui_key_PeopleBackedCampaign\'|xlat:({\'nBacked\':campaign.nBacked})"></p></div></div><div class="col-xs-6 text-center"><div ng-bind-html="\'_ui_key_CollectedFund2\'|xlat:({\'collectedFund\':(campaign.collectedFund | awnum:\'price\')})"></div></div></div><div class="row" style="padding:0px"><div class="text-center"><div class="target-fund" ng-bind-html="\'_ui_key_TargetFund2\'| xlat:({\'targetFund\':(campaign.targetFund | awnum:\'price\')})"></div></div></div></div></div><div class="row campaign-body"><div class="col-sm-8"><div campaign-tabs="" campaign="campaign" active="0" fixed-height="false" campaign-rewards="undefined" class="campaign-tabs"></div></div><div class="col-sm-4"><div class="row reward-wrap" ng-repeat="reward in campaignRewards"><div reward-template="" reward="reward" show-reward-image="true"></div></div></div></div></div>'),$templateCache.put("app/components/campaign/details/campaignTabsTemplate",'<uib-tabset active="active"><uib-tab heading="{{\'tabs_item_description_fa\'|xlat}}"><div class="story" ng-class="{\'scroll-container\':fixedHeight}"><div ng-class="{\'scroll-content\':fixedHeight}"><div style="direction:rtl"><div ng-repeat="stElm in campaign.storyElements" ng-bind-html="stElm.text"></div></div><div style="height:3em"></div></div><div ng-if="fixedHeight && !Modernizr.touch" class="scroll-mask"></div></div></uib-tab><uib-tab heading="{{\'tabs_item_update_fa\'| xlat}}"><p>details2</p></uib-tab><uib-tab heading="{{\'tabs_item_backers_fa\'|xlat}}"><p>details3</p></uib-tab><uib-tab ng-if="campaignRewards"><uib-tab-heading><div ng-bind-html="\'_ui_key_RewardsTab\'|xlat"></div></uib-tab-heading><div class="rewards-container scroll-container"><div class="scroll-content"><div class="reward-wrap col-xs-6" ng-repeat="campaignReward in campaignRewards"><div class="reward" reward="campaignReward" reward-template="" hide-reward-image="true"></div></div><div style="height:3em"></div></div><div ng-if="!Modernizr.touch" class="scroll-mask"></div></div></uib-tab></uib-tabset>'),$templateCache.put("app/components/campaign/edit/docTableTemplate",'<table class="table table-bordered table-hover"><thead><th>#</th><th>توضیحات</th></thead><tbody><tr ng-repeat="doc in docs"><th>{{$index+1}}</th><td>{{doc.description}}</td></tr></tbody></table>'),$templateCache.put("app/components/campaign/edit/editCampaignBasicTemplate",'<form name="basicForm"><div id="new-camp-header" class="row" ng-if="newCampaign"><p ng-show="pageProps.campaignId">کمپین \'{{campaignResInstance.title}}\' ایجاد شد. شما می توانید الآن یا بعدا مشخصات آن را کامل کنید.</p><h2>کمپین خود را <span ng-hide="pageProps.campaignId">شروع کنید</span> <span class="mishavad" ng-show="pageProps.campaignId">کامل کنید</span></h2><p ng-hide="pageProps.campaignId">خلاقیت و کارآفرینی را با یک کمپین شروع کنید.</p></div><div class="very-basic-details"><div class="row field-row"><div class="form-group col-md-6 col-sm-6"><label>عنوان کمپین</label> <input type="text" class="form-control" ng-model="campaignResInstance.title"></div></div><div class="row field-row"><div class="form-group col-md-6 col-sm-6"><label>مبلغی که می خواهید تأمین شود</label> <input class="form-control" ng-model="campaignResInstance.targetFund" placeholder="مبلغ بر حسب تومان" num-int="11" num-fract="0" num-thousand="true" awnum=""></div></div><div class="row field-row"><div class="form-group col-md-4 col-sm-5 col-xs-8" id="rowTagline" ng-class="{\'has-error shake\' : submitted && form.Tagline.$invalid}"><label>یک جمله زیبا برای کمپین شما در صفحه اول می شود</label> <textarea ng-required="" rows="4" id="Tagline" maxlength="100" required="" class="form-control" ng-model="campaignResInstance.tagline"></textarea></div><div class="col-md-4 col-sm-4 col-xs-4">تعداد کاراکتر باقیمانده: {{100-campaignResInstance.tagline.length}}</div></div></div><div class="row btn-create-wrap" ng-show="newCampaign && !pageProps.campaignId"><div class="form-group col-sm-4"><button class="btn btn-success btn-bez btn-bez-sm" ng-class="{\'waiting\': campBasicWaiting}" ng-click="updateCampBasic()" ng-bind-html="\'_ui_key_CreateCampaign\' | xlat"></button></div></div><div class="basic-details" ng-if="pageProps.campaignId"><div class="row field-row"><div class="form-group image-editor-container col-sm-6" ng-class="{\'edit-mode\': campaignResInstance.thumbCropMode==true}"><label>تصویر کمپین <span class="fa fa-question-circle fa-lg"></span></label><div img-crop="" class="img-crop" area-min-size="{width:285, height:200}" image="campaignResInstance.newThumbnail || campaignResInstance.thumbnail" result-image-format="image/jpeg" result-image-ratio="1" result-image-quality=".8" result-image="campaignResInstance.base64Thumbnail"></div><label class="btn btn-primary btn-image-input">تغییر تصویر <input type="file" class="file-input" img-file-input="" file-input-loaded="fileInputLoaded(imageData)"></label></div></div><div class="row field-row"><div class="form-group col-md-6 col-sm-6"><label>نوع کمپین:</label><select class="form-control" ng-model="campaignResInstance.categoryId" convert-to-number=""><option ng-repeat="option in campaignType.availableOptions" value="{{option.id}}">{{option.name}}</option></select></div></div><div class="row field-row"><div class="form-group col-md-6 col-sm-6"><label>مرحله کمپین:</label><select class="form-control" ng-model="campaignResInstance.projectStageId" convert-to-number=""><option ng-repeat="option in campaignLevel.availableOptions" value="{{option.id}}">{{option.name}}</option></select></div></div><div class="row field-row"><div class="form-group col-md-12 col-sm-12"><label>تامین بودجه کمپین چند روز مهلت داشته باشد؟</label><div class="btn-group"><label class="btn btn-primary" ng-model="campaignResInstance.totalDays" uib-btn-radio="90">۹۰ روز</label> <label class="btn btn-primary" ng-model="campaignResInstance.totalDays" uib-btn-radio="60">۶۰ روز</label> <label class="btn btn-primary" ng-model="campaignResInstance.totalDays" uib-btn-radio="30">۳۰ روز</label></div></div></div><div class="row field-row"><div class="form-group col-md-6 col-sm-6"><label>تگ ها <span class="fa fa-question-circle fa-lg"></span></label><input type="text" ng-change="populateTags()" ng-model="campaignResInstance._newTag" ng-keypress="$event.which === 13 && addNewTag()" class="form-control new-tag"> <a ng-click="addNewTag()">اضافه کردن</a><div class="tags-container"><div class="camp-tag" ng-repeat="data in campaignResInstance.tags track by $index">{{data}}<span class="fa fa-times-circle" ng-click="removeTag($index)"></span></div></div></div></div><div class="row field-row"><div class="form-group col-md-6 col-sm-6"><div class="row"><div class="col-xs-12"><label>آیا این کمپین توسط سازمان خاصی تأیید شده است؟</label><div class="btn-group"><label class="btn btn-success" ng-model="campaignResInstance.verifiedByOrg" uib-btn-radio="true">بله</label> <label class="btn btn-danger" ng-model="campaignResInstance.verifiedByOrg" uib-btn-radio="false">خیر</label></div></div><div class="col-xs-12"><label>توضیحات در مورد تاییده سازمان</label><div><textarea class="form-control" ng-model="campaignResInstance.verificationDescription"></textarea></div></div></div></div></div><div class="row field-row"><div class="form-group col-lg-3 col-md-4 col-sm-6"><label>شما در کدام استان مستقر هستید؟</label><div><select class="form-control" ng-model="campaignResInstance.province"><option ng-repeat="(option,value) in (campaignProvince.availableOptions | groupBy:\'provinceName\')" ng-selected="option==\'campaignResInstance.cityId\'" value="{{option}}">{{option}}{{alert(0)}}</option></select></div></div><div class="form-group col-lg-3 col-md-4 col-sm-6"><label>کدام شهر مستقر هستید؟</label><div><select class="form-control" ng-model="campaignResInstance.cityId" convert-to-number=""><option ng-repeat="option in campaignCity.availableOptions" ng-if="option != null" value="{{option.id}}">{{option.name}}</option></select></div></div></div><div class="form-group"><a class="btn btn-success btn-large btn-bez btn-bez-lg" ng-class="{\'waiting\': campBasicWaiting}" ng-click="updateCampBasic()">ذخیره و رفتن به توضیحات کمپین</a></div></div></form>'),$templateCache.put("app/components/campaign/edit/editCampaignRewardsTemplate",'<div class="row"><div class="col-md-3 col-sm-4 reward-wrap" ng-repeat="reward in rewardQueryInstance"><a class="btn btn-primary btn-edit" ng-click="addOrEditReward($index)">ویرایش</a> <a class="btn btn-primary btn-remove" ng-click="showRemoveBox=true">حذف</a><div class="reward-inner" reward-template="" reward="reward" hide-n-claimed="true"></div><div class="remove-box" ng-show="showRemoveBox"><p>آیا برای حذف مطمئن هستید</p><a class="btn btn-danger" ng-click="removeReward($index)">بلی</a> <a class="btn btn-default" ng-click="showRemoveBox=false">خیر</a></div></div><div class="col-md-3 col-sm-4 reward-wrap"><a class="btn btn-primary" ng-click="addOrEditReward()">اضافه کردن پاداش</a></div></div>'),$templateCache.put("app/components/campaign/edit/editCampaignStoryTemplate",'<div class="row"><div class="form-group col-md-6 col-sm-6"><label>ویدئوی کمپین</label><div class="msh-break-word">برای تبدیل ویدئو به فرمت MP4 و کوچک کردن حجم آن می توانید از لینک زیر استفاده کنید: <a href="http://www.freemake.com/free_video_converter/" target="_blank">http://www.freemake.com/free_video_converter/</a></div></div></div><div class="row"><div class="story-elements-wrap col-xs-10 col-xs-offset-1"><div id="elm{{$id}}" ng-repeat="stElm in campaignStoryElements" class="row story-element" ng-class="{\'edit-mode\': stElm.editMode,\'view-mode\':!stElm.editMode}"><div class="editor" ng-if="(stElm.type == \'text\')"><ng-wig ng-model="stElm.editorText" on-paste="onPaste($event, pasteContent)" buttons="formats, bold, italic, list1, list2, link"></ng-wig><div class="edit-buttons"><a class="btn btn-success" ng-click="saveTextElm($index)">ذخیره</a> <a class="btn btn-danger" ng-click="cancelTextEdit($index)">انصراف</a></div></div><div class="text-viewer-wrap" ng-if="(stElm.type == \'text\')"><div ng-bind-html="stElm.text" class="text-viewer"></div></div><div class="" ng-if="stElm.type == \'image\'"><div class="form-group image-editor-container" ng-class="{\'edit-mode\': stElm.editMode==true}"><div ng-if="stElm.editMode"><div img-crop="" class="img-crop" area-min-size="{width:285, height:200}" image="stElm.newImage || getImageByIndex($index)" result-image-format="image/jpeg" result-image-ratio="1" result-image-quality=".75" result-image="stElm.imageModel"></div><div ng-show="stElm.imageModel"><label class="btn btn-primary btn-image-input">انتخاب تصویر <input ng-disabled="stElm.saveWaiting" type="file" class="file-input" trigger-click="{{stElm.triggerClick}}" img-file-input="" file-input-loaded="fileInputLoaded($index,imageData)"></label> <button type="button" class="btn btn-success btn-bez btn-bez-xs" ng-class="{waiting:stElm.saveWaiting}" ng-click="saveImageEdit($index)">ذخیره</button> <a class="cancel btn btn-danger" ng-disabled="stElm.saveWaiting" ng-click="cancelImageEdit($index)">انصراف</a></div></div><img ng-src="{{getImageByIndex($index)}}" ng-show="!stElm.editMode" class="center-block img-responsive"></div></div><div class="initialized-story-controls" ng-show="stElm.type"><button type="button" class="btn btn-primary btn-edit" ng-show="stElm.editMode!=true" ng-click="enterEditMode($index)">{{\'_ui_key_Edit\' | xlat}} <i class="fa fa-edit" aria-hidden="true"></i></button> <button type="button" class="btn btn-primary btn-remove" ng-show="stElm.editMode!=true" ng-click="showRemoveBox=true">حذف <i class="fa fa-trash" aria-hidden="true"></i></button><div class="remove-box" ng-show="showRemoveBox"><p>آیا برای حذف مطمئن هستید</p><a class="btn btn-danger" ng-click="removeStoryElement($index)">بلی</a> <a class="btn btn-default" ng-click="showRemoveBox=false">خیر</a></div><div class="move-buttons"><a class="btn btn-default btn-move-up" ng-hide="isFirstInitializedSt($index)" ng-click="listElmUp($index, $id)"><i class="fa fa-arrow-up" aria-hidden="true"></i></a> <a class="btn btn-default btn-move-down" ng-hide="isLastInitializedSt($index)" ng-click="listElmDown($index, $id)"><i class="fa fa-arrow-down" aria-hidden="true"></i></a></div></div><div class="row empty-story-controls" ng-if="!stElm.type"><label class="btn col-sm-6" ng-click="initializeStElm($index,\'text\')"><i class="fa fa-plus" area-hidden="true"></i> اضافه کردن متن</label> <label class="btn col-sm-6"><i class="fa fa-plus" area-hidden="true"></i> اضافه کردن تصویر <input type="file" class="file-input" trigger-click="{{stElm.triggerClick}}" img-file-input="" file-input-loaded="initializeStElm($index,\'image\',imageData)"></label></div></div></div></div>'),$templateCache.put("app/components/campaign/edit/editCampaignUploadDocsTemplate",'<div class="row"><div class="col-md-6"><h2>مدارک هویتی پروژه آفرین (تصویر)</h2><doc-table docs="userDocQueryInstance"></doc-table><form name="uploadUserDocForm" ng-submit="uploadDoc(\'userDoc\')"><div img-crop="" class="img-crop" image="newUserDocument._src" result-image-format="image/jpeg" result-image-ratio="1" result-image-quality=".8" result-image="newUserDocument.base64Image"></div><label class="btn btn-primary btn-image-input">انتخاب تصویر <input type="file" class="file-input" img-file-input="" file-input-loaded="newUserDocument._src = imageData"></label><div class="row"><div class="form-group" <label="">توضیحات مدرک<div><textarea class="form-control" name="description" required="" ng-model="newUserDocument.description"></textarea></div></div></div><div uib-alert="" class="alert-warning" ng-messages="uploadUserDocForm.description.$error" role="alert"><div ng-message="required">لطفا توضیحات مربوط به مدرک را وارد کنید</div></div><button type="submit" class="btn btn-bez btn-bez-sm btn-primary" ng-class="{\'waiting\':newUserDocument._isWaiting}">آپلود</button></form></div></div><div class="row"><div class="col-md-6"><div class="row"><h2>مدارک کمپین (تصویر)</h2><doc-table docs="campaignDocQueryInstance"></doc-table><div img-crop="" class="img-crop" image="newCampaignDocument._src" result-image-format="image/jpeg" result-image-ratio="1" result-image-quality=".8" result-image="newCampaignDocument.base64Image"></div><label class="btn btn-primary btn-image-input">انتخاب تصویر <input type="file" class="file-input" img-file-input="" file-input-loaded="newCampaignDocument._src = imageData"></label></div><div class="row"><label>توضیحات مدرک</label><div><textarea class="form-control" name="description" required="" ng-model="newCampaignDocument.description"></textarea></div></div><div class="row"><label class="btn btn-bez btn-bez-sm btn-primary" ng-class="{\'waiting\':newCampaignDocument._isWaiting}" ng-click="uploadDoc(\'campaignDoc\')">آپلود</label></div></div></div>'),$templateCache.put("app/components/campaign/edit/editCampaignView",'<div id="edit-camp-page" class=""><div class="well" ng-if="isLoggedIn==false"><p ng-bind-html="\'_ui_key_EditCampaignLoginNotice\' | xlat"></p><p>لطفا برای <span ng-show="pageProps.campaignId">ویرایش</span> <span ng-hide="pageProps.campaignId">ایجاد</span> کمپین به حساب کاربری خود <a ng-click="openLogin();">وارد شوید</a></p></div><div ng-if="isLoggedIn"><div class="box-alert"><div uib-alert="" ng-repeat="alert in alerts" ng-class="\'alert-\' + alert.type" close="closeAlert($index)">{{alert.msg}} <a ng-if="alert.promiseFunc" class="btn btn-link" ng-click="tryAgain($index, alert.promiseFunc())">دوباره آپدیت کن</a></div></div><div class="corner-alert"><div uib-alert="" ng-if="v.isDirty && v.isDeselected" ng-repeat="(k,v) in dirtyForms" ng-class="\'alert-\' + v.type" close="closeCornerAlert(k)">{{v.msg}}</div></div><uib-tabset active="pageProps.activeTab" ng-class="{ \'has-alerts\': alerts.length, \'new-campaign\':newCampaign, \'has-camp-id\':pageProps.campaignId}"><uib-tab index="0" heading="{{ \'_ui_key_BasicTabHeading\' | xlat}}" select="tabSelected($event, \'basic\')" deselect="tabDeselected($event, \'basic\')"><div edit-campaign-basic="" class="camp-basic container-fluid"></div></uib-tab><uib-tab index="1" heading="{{ \'_ui_key_StoryTabHeading\' | xlat}}" select="tabSelected($event, \'story\')" deselect="tabDeselected($event, \'story\')"><div edit-campaign-story="" class="container-fluid"></div></uib-tab><uib-tab index="2" heading="{{ \'_ui_key_RewardsTabHeading\' | xlat}}"><div edit-campaign-rewards="" class="edit-camp-rewards container-fluid"></div></uib-tab><uib-tab index="3" heading="{{ \'_ui_key_DocumentsTabHeading\' | xlat}}"><div edit-campaign-upload-docs="" class="container-fluid"></div></uib-tab><uib-tab index="4" heading="{{ \'_ui_key_ReviewTabHeading\' | xlat}}" classes="edit-camp-review"><div edit-campaign-review="" class="container-fluid"></div></uib-tab></uib-tabset></div></div>'),$templateCache.put("app/components/campaign/reward/campaignRewardTemplate",'<div ng-if="!hideRewardImage" class="row reward-img"><div class="col-md-12"><img class="img-responsive rewards" ng-src="{{reward.base64Image || reward.imagePath}}"></div></div><div class="h3 amount">{{reward.amount| seprate}} <label ng-bind="\'_ui_key_Toman\'|xlat"></label></div><h3 class="">{{reward.title}}</h3><p class="">{{reward.description}}</p><p class=""><label ng-bind="\'reward_accept_time_fa\'|xlat"></label> {{reward.estimatedDeliveryDateUtc | pDate}}</p><p class="" ng-if="!hideNClaimed"><span class="label label-info">{{reward.nClaimed}}</span> <label ng-bind="\'reward_accept_count_fa\'|xlat"></label></p><p class=""><label ng-bind="\'reward_Stock_fa\'|xlat"></label>{{reward.nAvailable}} <label ng-bind="\'reward_Stock_count_unit_fa\'|xlat"></label></p>'),$templateCache.put("app/components/campaign/reward/editRewardTemplate",'<div class="modal-header"><h3 class="modal-title">ویرایش پاداش</h3><a class="fa fa-times fa-2x close" ng-click="dismissModal()"></a></div><div class="modal-body"><div class="edit-reward-wrapper container-fluid"><div class="row"><div class="col-md-6 form-group"><label>{{\'_ui_key_RewardName\' | xlat}}</label> <input type="text" class="form-control" ng-model="reward.title" placeholder="نام" value=""></div><div class="col-md-6 form-group"><label>{{\'_ui_key_GiftAmount\' | xlat}}</label> <input type="text" class="form-control" ng-model="reward.amount" placeholder="تومان"></div></div><div class="row"><div class="form-group image-editor-container col-md-6" ng-class="{\'edit-mode\': imageEditMode==true}"><label>تصویر پاداش <span class="fa fa-question-circle fa-lg"></span></label><div img-crop="" class="img-crop" area-min-size="{width:285, height:200}" image="reward.newImage || reward.imagePath" result-image-format="image/jpeg" result-image-ratio="1" result-image-quality=".8" result-image="reward.base64Image"></div><label class="btn btn-primary btn-image-input">تغییر تصویر <input type="file" class="file-input" img-file-input="" file-input-loaded="fileInputLoaded(imageData)"></label> <button type="button" class="btn btn-primary btn-edit-img" ng-click="$broadcast(\'EnterCropEditModeEvent\', imageEditMode=true )">ویرایش</button></div><div class="form-group col-md-6"><label>{{\'_ui_key_RewardDesc\' | xlat}}</label> <textarea ng-required="" rows="4" maxlength="100" required="" class="form-control" ng-model="reward.description"></textarea><div class="description-length">تعداد کاراکتر {{100-reward.Description.length}}</div></div></div><div class="row"><div class="form-group"><label>{{\'_ui_key_RewardDeliveryDays\' | xlat}}</label> <input type="text" class="form-control" ng-model="reward.deliveryDays" placeholder="روز"></div></div><div class="row"><div class="form-group"><label>{{\'_ui_key_RewardNAvailable\' | xlat}}</label> <input type="text" class="form-control" ng-model="reward.nAvailable" placeholder="عدد"></div></div></div><div uib-alert="" class="alert-danger" ng-bind="alertMessage | xlat" ng-show="showAlert"></div></div><div class="modal-footer"><button class="btn btn-default btn-bez btn-bez-md" type="submit" ng-class="{\'waiting\': isWaiting}" ng-click="submitReward()">{{\'_ui_key_Save\' | xlat}}</button></div>'),$templateCache.put("app/components/campaign/edit/directives/cropimgTemplate",'<label class="btn btn-primary btn-image-input">انتخاب تصویر <input type="file" class="cropit-image-input" style="visibility: hidden;width:50px;height:0px"></label> <button type="button" class="save btn btn-success btn-bez btn-bez-xs" ng-class="{waiting:isWaiting}">ذخیره</button> <a class="cancel btn btn-danger" ng-click="cancel()">انصراف</a><div class="image-toolbar"><div class="image-zoom row text-right" style="direction: ltr; width: 300px;"><div class="col-xs-4" style="padding: 0; white-space: nowrap;"><label class="image-zoom-label" style="direction:rtl; display: block">بزرگ نمایی (Zoom):</label></div><div class="col-xs-8"><span class="fa fa-image" style="vertical-align: middle;"></span> <input type="range" value="0" class="cropit-image-zoom-input" style="vertical-align: middle;display: inline-block;width: 110px;margin: 3px;"> <span class="fa fa-image fa-2x" style="vertical-align: middle;"></span></div></div><div class="image-size"><label class="image-size-label" style="direction: rtl">اندازه تصویر:</label> <a class="btn btn-primary" ng-click="$broadcast(\'CropChangeSizeEvent\',{width:320,height:240})">کوچک</a> <a class="btn btn-primary" ng-click="$broadcast(\'CropChangeSizeEvent\',{width:460,height:308})">متوسط</a> <a class="btn btn-primary" ng-click="$broadcast(\'CropChangeSizeEvent\',{width:800,height:600})">بزرگ</a></div></div><div class="cropit-preview"></div>')}]),angular.module("app").config(["dynamicNumberStrategyProvider",function(dynamicNumberStrategyProvider){dynamicNumberStrategyProvider.addStrategy("price",{numInt:6,numFract:4,numSep:".",numPos:!0,numNeg:!1,numRound:"round",numThousand:!0,numThousandSep:","})}]).config(["$animateProvider",function($animateProvider){$animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/)}]).factory("removeUnderscorePrefixedInterceptor",["$q",function($q){return{request:function(config){return angular.isObject(config.data)&&angular.forEach(config.data,function(value,key){0===key.indexOf("_")&&delete config.data[key]}),config}}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("removeUnderscorePrefixedInterceptor")}]).run(["$rootScope","$anchorScroll",function($rootScope,$anchorScroll){$rootScope.$on("$locationChangeStart",function(event,newUrl,oldUrl,newState,oldState){console.dir("location change start oldUrl:"+oldUrl+",newUrl:"+newUrl),newUrl!=oldUrl&&$anchorScroll()})}]),angular.module("app").config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/about",{templateUrl:"app/components/home/aboutView",reloadOnSearch:!1}).when("/account",{templateUrl:"app/components/account/accountView",controller:"AccountController",reloadOnSearch:!1}).when("/account/email-confirmed",{templateUrl:"app/components/account/emailconfirmedView"}).when("/campaigns/:campaignId/contribute",{templateUrl:"app/components/campaign/contribute/contributeView",controller:"ContributeController",resolve:{delay:["$q","$timeout",function($q,$timeout){var delay=$q.defer();return $timeout(delay.resolve,200),delay.promise}]},reloadOnSearch:!1}).when("/create-campaign-old",{templateUrl:"app/components/campaign/create/createCampaignView"}).when("/create-campaign",{templateUrl:"app/components/campaign/edit/editCampaignView",controller:"EditCampaignController",reloadOnSearch:!1}).when("/campaigns/:campaignId/edit",{templateUrl:"app/components/campaign/edit/editCampaignView",controller:"EditCampaignController",reloadOnSearch:!1}).when("/campaigns/:campaignId",{templateUrl:"app/components/campaign/details/CampaignDetails.tpl",controller:"CampaignDetailsController"}).when("/home",{reloadOnSearch:!1,templateUrl:"app/components/home/homeView",controller:"HomeController",resolve:{func:["$route","$location",function($route,$location){}]}}).when("/",{redirectTo:"/home"}),$locationProvider.html5Mode(!0)}]),angular.module("app").constant("constantsUtils",{API_V1_URL:"http://mishavad.ir/api",SERVER_URL:"http://mishavad.ir",softDeleteTransform:function(){return angular.toJson({removedFlag:!0})}}),angular.module("app").filter("xlat",["XlatService",function(XlatService){return function(label,parameters){return XlatService.xlat(label,parameters)}}]),angular.module("app").constant("translateProvider",{fa:{tabs_item_description_fa:"توضیحات",tabs_item_description_inner_target_fa:"هدف",_ui_key_Person:"نفر",tabs_item_update_fa:"به روز رسانی",tabs_item_backers_fa:"حامیان کمپین",_ui_key_GalleryTabHeading:"گالری تصاویر",reward_accept_count_fa:"نفر این پاداش را دریافت کرده اند",reward_accept_time_fa:"زمان تقریبی دریافت: ",reward_accept_time_daily_count_fa:"روز ",reward_Stock_fa:"موجودی : ",reward_Stock_count_unit_fa:"عدد",_ui_key_Browse:"فایل را انتخاب کنید",_ui_key_BasicTabHeading:"مشخصات کمپین",_ui_key_BavarKonidMishavad:" باور کنید می شود ;)",_ui_key_BrowseCampaignBanner:"کمپین های می شود را ببینید",_ui_key_CampaignCategory:"زمینه فعالیت",_ui_key_CampaignTitle:"عنوان کمپین",_ui_key_CompleteCreateCampaignMessage:"کمپین شما با عنوان {0} ایجاد شد. لطفا مشخصات آن را تکمیل کنید.",_ui_key_CompleteCreateCampaignTitle:"تکمیل مشخصات کمپین",_ui_key_ConfirmPassword:"تأیید رمز عبور",_ui_key_ConnectionError:"خطا در اتصال به سرور. لطفا کمی بعدتر دوباره تلاش کنید",_ui_key_CollectedFundOnly:'{{param_collectedFund}}<span class="toman">{{"_ui_key_Toman"|xlat}}</span>',_ui_key_CollectedFund2:'{{param_collectedFund}}<span class="toman">{{"_ui_key_Toman"|xlat}}</span>جمع شده',_ui_key_Contribute:"می خواهم حمایت کنم",_ui_key_ContributeStepsNote:"چند قدم تا رساندن پیام *می شود* به بانیان کمپین",_ui_key_ContributeLong:"کمپین های فعال *می شود* را ببینید و به آن ها کمک کنید .",_ui_key_CreateCampaign:" ایجاد کمپین <i class='fa fa-rocket fa-lg'></i>",_ui_key_CreateCampaignBanner:" یک کمپین ایجاد کنید! <i class='fa fa-rocket fa-lg'></i>",_ui_key_CreateCampaignRegisterNotice:"برای ایجاد کمپین باید در *می شود* عضو باشید.",_ui_key_CreateCampaignLong:"یک کمپین ایجاد کنید و برای به ثمر رسیدن ایده تان از دیگران کمک بخواهید",_ui_key_DocumentsTabHeading:"آپلود مدارک",_ui_key_Edit:"ویرایش",_ui_key_EditCampaign:"ویرایش مشخصات کمپین",_ui_key_EditCampaignLoginNotice:"شما به این بخش دسترسی ندارید",_ui_key_Email:"ایمیل",_ui_key_EndDate:"تاریخ پایان کمپین",_ui_key_FileAddress:"آدرس فایل",_ui_key_FirstName:"نام",_ui_key_GiftAmount:"میزان حمایت",_ui_key_GiftFundDate:"تاریخ کمک",_ui_key_Head:"*می شود*",_ui_key_Hi:"سلام {0} !",_ui_key_LastName:"نام خانوادگی",_ui_key_LogIn:"ورود به حساب کاربری",_ui_key_LogOff:"خروج از حساب کاربری",_ui_key_LoginError:"نام کاربری یا رمز عبور اشتباه است!",_ui_key_Mobile:"موبایل",_ui_key_NickName:"نام مستعار",_ui_key_NoUserCampaigns:"شما تا کنون کمپینی ایجاد نکرده اید.",_ui_key_NoUserGiftFunds:"شما تا کنون به کمپینی کمک نکرده اید.",_ui_key_Password:"رمز عبور",_ui_key_Payment:"پرداخت",_ui_key_PayMishavad:"پرداخت از طریق حساب *می شود*",_ui_key_PayShetab:" پرداخت بانکی <span class='small'>(از طریق کارت های شتاب)</span>",_ui_key_PeopleBackedCampaign:'{{param_nBacked}}<span class="person">{{"_ui_key_Person"|xlat}}</span> حمایت کردند',_ui_key_ProjectStage:"مرحله پروژه",_ui_key_Register:"ثبت نام",_ui_key_RegisterAsaNewUser:"اگر عضو نیستید می توانید همین حالا ثبت نام کنید!",_ui_key_RegisterTitle:"به خانواده *می شود* بپیوندید","_ui_key_Remember me?":"من را به خاطر داشته باش",_ui_key_ReviewTabHeading:"مرور و درخواست بررسی",_ui_key_RewardName:"نام پاداش",_ui_key_RewardDesc:"توضیحات پاداش",_ui_key_RewardDeliveryDays:"ارسال پاداش چند روز (از پایان کمپین) طول می کشد؟",_ui_key_RewardNAvailable:"تعداد موجود پاداش",_ui_key_RewardsTab:"<i class='fa fa-lg fa-gift'></i> پاداش ها",_ui_key_RewardsTabHeading:"پاداش ها",_ui_key_Save:"ذخیره",_ui_key_StartDate:"تاریخ شروع",_ui_key_StatusPreliminaryRegistered:"ثبت اولیه",_ui_key_StatusApproved:"تأیید شده",_ui_key_StatusReadOnly:"ReadOnly",_ui_key_StatusWaiting:"در انتظار بررسی",_ui_key_StoryTabHeading:"داستان کمپین شما",_ui_key_Tagline:"یک جمله زیبا برای کمپین شما",_ui_key_TargetFund:"هزینه مورد نیاز پروژه",_ui_key_TargetFund2:'هدف:{{param_targetFund}}<span class="toman">{{"_ui_key_Toman"|xlat}}</span>',_ui_key_TargetFundRangeError1:"حداقل میزان کمک 10000 تومان است. ",_ui_key_Thumbnail:"تصویر کمپین",_ui_key_TimeLeft:"{{param_readableTimeLeft}} باقیمانده",_ui_key_Toman:"تومان",_ui_key_Upload:"آپلود",_ui_key_UploadCampaignThumbnail:"آپلود تصویر کمپین",_ui_key_UserCampaigns:"کمپین های ایجاد شده",_ui_key_UserGiftFunds:"کمک های انجام شده",_ui_key_UserProfile:"حساب کاربری",_ui_key_VerificationDescription:"توضیح",_ui_key_VerifiedByOrg:"آیا طرح یا پروژه مورد نظر این کمپین دارای تأییدیه از سازمان یا مرکزی می باشد؟",_ui_key_WelcomeMessage1:" می شود جایی است که شما به محقق شدن ایده های هم وطنانتان کمک می کنید و به آن ها می گویید &rdquo;*می شود*&ldquo;",_ui_key_MustContainAtLeastChars:"{0} باید حداقل شامل {2} کاراکتر باشد.",PasswordValidation_InvalidChars:"کاراکترهای رمز عبور معتبر نیستند. آیا کیبورد فارسی است؟",PasswordValidation_ShortLength:"رمز عبور باید حداقل {{param_0}} کاراکتر باشد",PasswordValidation_NotMatch:"رمز عبور و تأیید آن با هم همخوانی ندارند.",PasswordValidation_SmallCapitalLetters:"رمز عبور باید حداقل یک حرف  کوچک و یک حرف بزرگ داشته باشد",PasswordValidation_NoNumbers:"رمز عبور باید حداقل یک عدد داشته باشد",PasswordValidation_ConsecutivelyRepeatedChars:"رمز عبور نباید از کاراکترهای تکراری پشت سر هم تشکیل شده باشد",PasswordValidation_ShamsiDate:"رمز عبور نباید تاریخ باشد"},en:{}}),angular.module("app").factory("XlatService",["$interpolate","translateProvider",function($interpolate,translateProvider){var countryCode=countryCode||"IR",currentLanguage="en";return"IR"==countryCode&&(currentLanguage="fa"),{setCurrentLanguage:function(){currentLanguage=newCurrentLanguage},getCurrentLanguage:function(){return currentLanguage},xlat:function(label,parameters){~label.indexOf(",")&&(label=label.split(","),parameters=label.slice(1),label=label[0]);var transText=translateProvider[currentLanguage][label];return transText=null==transText?label:transText.replace(new RegExp("\\*می شود\\*","g"),'<span class="mishavad">می&zwnj;شود</span>'),null==parameters||0==parameters.length?transText:(angular.forEach(parameters,function(value,key){parameters["param_"+key]='<span class="param-'+key+'">'+value+"</span>"}),$interpolate(transText)(parameters))}}}]),angular.module("app").controller("AccountController",["$scope","userinfoFactory","campaignResource",function($scope,userinfoFactory,campaignResource){$scope.getUserData=function(){if($scope.isLoggedIn){var Userinfo=userinfoFactory($scope.access_token);$scope.userinfo=Userinfo.get(),$scope.userCampaigns=campaignResource($scope.access_token).query_user_campaigns(function(){for(var i=0;i<$scope.userCampaigns.length;i++){var c=$scope.userCampaigns[i];c.isApproved=~c.status.indexOf("Approved"),c.status=c.status.replace(/\s/g,"").split(",")}})}},$scope.getUserData(),$scope.$watch("isLoggedIn",function(){$scope.getUserData()}),$scope.removeCampaign=function(ind){$scope.userCampaigns[ind].$soft_delete(function(){$scope.userCampaigns.splice(ind,1)},function(){})}}]).factory("userinfoFactory",["$resource","constantsUtils",function($resource,constantsUtils){return function(access_token){return $resource(constantsUtils.API_V1_URL+"/Account/UserInfo",{Id:"@Id"},{get:{method:"GET",headers:{Authorization:"Bearer "+access_token}}})}}]),angular.module("app").service("loginService",["$http","constantsUtils",function($http,constantsUtils){this.getToken=function(user,pass,successCallbackFunc,errorCallbackFunc){$http({method:"POST",url:constantsUtils.SERVER_URL+"/Token",data:"grant_type=password&username="+encodeURIComponent(user)+"&password="+encodeURIComponent(pass),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){successCallbackFunc(response)},function(response){errorCallbackFunc(response)})}}]).controller("LoginController",["$scope","$timeout","loginService","$uibModalInstance","$location",function($scope,$timeout,loginService,$uibModalInstance,$location){$scope.submitLogin=function(){$scope.isWaiting=!0,$scope.showAlert=!1,$timeout(function(){loginService.getToken($scope.loginEmail,$scope.loginPassword,function(tokenData){$uibModalInstance.close(tokenData)},function(data){$scope.isWaiting=!1,$scope.showAlert=!0,400==data.status?$scope.alertMessage="_ui_key_LoginError":$scope.alertMessage="_ui_key_ConnectionError"})},500)},$scope.$on("$locationChangeStart",function(event){"login"!=$location.state()&&$uibModalInstance.dismiss()})}]),angular.module("app").controller("RegisterController",["$scope","$timeout","$http","$location","$uibModalInstance","constantsUtils","redirectUrl",function($scope,$timeout,$http,$location,$uibModalInstance,constantsUtils,redirectUrl){$scope.alerts=[],$scope.submitRegister=function(){if(null==$scope.registerModel)return $scope.showAlert=!0,void($scope.alertMessage="لطفا اطلاعات بالا را وارد کنید");$scope.isWaiting=!0,$scope.alerts=[],$scope.registerModel.redirectUrl=redirectUrl,console.log($scope.registerModel),$timeout(function(){$http({method:"POST",url:constantsUtils.API_V1_URL+"/Account/Register",headers:{"Content-Type":"application/json"},data:$scope.registerModel}).then(function(tokenData){$scope.isWaiting=!1,$scope.alerts.push({type:"success",msg:"ثبت نام شما انجام شد. به زودی ایمیلی حاوی لینک تأیید ایمیل برای شما فرستاده خواهد شد. ایمیل خود را چک کنید."})},function(data){$scope.isWaiting=!1;var ms=data.data.modelState;if(console.log(ms),ms)angular.forEach(ms,function(errors,key){angular.forEach(errors,function(errorMessage){$scope.alerts.push({type:"danger",msg:errorMessage})})});else{var message=data.data.message;message&&(errors=message.split("|"),angular.forEach(errors,function(errorMessage){$scope.alerts.push({type:"danger",msg:errorMessage})}))}console.log(data)})},500)},$scope.$on("$locationChangeStart",function(event){"register"!=$location.state()&&$uibModalInstance.dismiss()})}]),angular.module("app").factory("campaignPagesResource",["$resource","constantsUtils",function($resource,constantsUtils){return function(url){return null==url&&(url=constantsUtils.API_V1_URL+"/Campaigns"),$resource(url,{},{get:{method:"GET"}})}}]).controller("HomeController",["$scope","$timeout","$location","campaignPagesResource",function($scope,$timeout,$location,campaignPagesResource){$scope.carouselInterval=5e3,$scope.slideShow={},$scope.campaignsPages=[],$scope.$watch("campaignsPages.length",function(){if($scope.campaigns=[],0!=$scope.campaignsPages.length){console.log("$scope.campaignsPages.length: "+$scope.campaignsPages.length);for(var i=0;i<$scope.campaignsPages.length;i++){var page=$scope.campaignsPages[i];$scope.campaigns=$scope.campaigns.concat(page.items)}var lastPage=$scope.campaignsPages[$scope.campaignsPages.length-1];$scope.nextPageLink=lastPage.nextPageLink}}),$scope.loadNextPage=function(){if($scope.nextPageLink)var page=campaignPagesResource($scope.nextPageLink).get(function(){$scope.campaignsPages.push(page)})},$timeout(function(){var page=campaignPagesResource().get(function(){$scope.campaignsPages.push(page)})},500),$scope.$on("SlideShowOpenedEvent",function(){$location.state("slide"),$scope.carouselInterval=5e7,$scope.isSlideShowOpen=!0,console.log("SlideShowOpenedEvent")}),$scope.$on("SlideShowClosedEvent",function(){$location.state("noslide"),console.log("SlideShowClosedEvent"),$scope.carouselInterval=5e3,$scope.isSlideShowOpen=!1})}]),angular.module("app").directive("cbpGridGallery",[function(){"use strict";return{scope:{campaigns:"=",triggerCloseEvent:"&onClose",triggerOpenEvent:"&onOpen"},link:function(scope,element,attrs){var docElem=window.document.documentElement,support_support3d=(Modernizr.prefixed("transition"),Modernizr.csstransitions,Modernizr.csstransforms3d);scope.setTransform=function(el,transformStr){el.style.WebkitTransform=transformStr,el.style.msTransform=transformStr,el.style.transform=transformStr},scope.getViewportW=function(){var client=docElem.clientWidth,inner=window.innerWidth;return client<inner?inner:client},scope.slideShow={currentIndex:-99},scope.setSlidesTransform=function(){var i=scope.slideShow.currentIndex;if(!(null==scope.campaigns||i<0))for(var slideWidth=document.getElementById("slide_"+i).offsetWidth,j=0;j<scope.campaigns.length;j++){scope.setTransform(document.getElementById("slide_"+i),"");var translateLeftVal=Number(-1*(scope.getViewportW()/2+slideWidth/2)),translateRightVal=Number(scope.getViewportW()/2+slideWidth/2);i==j?scope.campaigns[j].transform="":j==i-1?scope.setTransform(document.getElementById("slide_"+j),support_support3d?"translate3d("+translateLeftVal+"px, 0, -150px)":"translate("+translateLeftVal+"px)"):j==i+1?scope.setTransform(document.getElementById("slide_"+j),support_support3d?"translate3d("+translateRightVal+"px, 0, -150px)":"translate("+translateRightVal+"px)"):j<i?scope.setTransform(document.getElementById("slide_"+j),support_support3d?"translate3d("+2*translateLeftVal+"px, 0, -150px)":"translate("+2*translateLeftVal+"px)"):i<j&&scope.setTransform(document.getElementById("slide_"+j),support_support3d?"translate3d("+2*translateRightVal+"px, 0, -150px)":"translate("+2*translateRightVal+"px)")}},scope.$watch("slideShow.currentIndex",function(i){scope.setSlidesTransform()}),scope.$watch(function(){for(var whole_p_length=0,ps=element.find("p"),i=0;i<ps.length;i++)null!=ps[i].innerHTML&&(whole_p_length+=ps[i].innerHTML.length);return whole_p_length},function(value){if(scope.setSlidesTransform(),scope.grid=document.querySelector("section.grid-wrap > ul.grid"),null!=scope.masonry){if(scope.grid.children.length!=scope.masonry.oldNumberOfChildren){console.log("new items added to masonry");for(var i=scope.masonry.oldNumberOfChildren;i<scope.grid.children.length;i++)scope.masonry.appended(scope.grid.children[i])}scope.masonry.layout()}else scope.masonry=new Masonry(scope.grid,{itemSelector:"li",columnWidth:".grid-sizer"});scope.masonry.oldNumberOfChildren=scope.grid.children.length})},templateUrl:"app/components/home/gridGalleryView",controller:["$scope","rewardResource","$timeout","$location",function($scope,rewardResource,$timeout,$location){$scope.openSlideShow=function(index){$scope.triggerOpenEvent(),$scope.slideShow.open=!0,null!=index&&$scope.setCurrentIndex(index)},$scope.setCurrentIndex=function(i){$scope.slideShow.currentIndex=i,$scope.slideShow.activeTabIndex=0,$scope.currentCampaignRewards=[],$scope.currentCampaign=$scope.campaigns[i],null!=$scope.getRewardsInstance&&$scope.getRewardsInstance.$cancelRequest(),$timeout(function(){$scope.getRewardsInstance=rewardResource().query({campaignId:$scope.currentCampaign.id},function(data){$scope.currentCampaignRewards=data},function(){console.log("failed loading rewards in slideshow")})},1500)},$scope.nextSlide=function(){$scope.slideShow.currentIndex<$scope.campaigns.length-1&&$scope.setCurrentIndex($scope.slideShow.currentIndex+1)},$scope.prevSlide=function(){0<$scope.slideShow.currentIndex&&$scope.setCurrentIndex($scope.slideShow.currentIndex-1)},$scope.closeSlideShow=function(){$scope.triggerCloseEvent(),$scope.slideShow.open=!1},$scope.$on("$locationChangeStart",function(event,newUrl,oldUrl,newState,oldState){newUrl==oldUrl?(console.dir("newState:"+newState),"noslide"==newState&&$scope.closeSlideShow(),"slide"==newState&&$scope.openSlideShow()):$scope.closeSlideShow()}),$scope.getHourglass=function(camp){if(0==camp.totalSecondsLeft)return"fa-hourglass-end";var ratio=camp.totalSecondsLeft/86400/camp.totalDays;switch(!0){case ratio<.2:return"fa-hourglass-start";case.2<=ratio:return"fa-hourglass-half"}}}]}}]).directive("homeCarousel",[function(){"use strict";return{scope:{interval:"="},templateUrl:"app/components/home/carouselView",controller:["$scope",function($scope){$scope.slides=[{id:0,image:"/FrontEnd/assets/img/ezatabad-jungle2.jpg",textColor:"white",backColor:"rgba(0,150,100,.5)",html:"_ui_key_WelcomeMessage1"},{id:1,image:"/FrontEnd/assets/img/paper-boats2.jpg",textColor:"white",backColor:"rgba(243,150,33,.5)",html:"ایده هایتان را از کاغذ به عمل تبدیل کنید!"},{id:2,image:"/FrontEnd/assets/img/bafgh-shen-ravan.jpg",textColor:"white",backColor:"rgba(33,150,243,.5)",html:"می شود تنها یک پلت فرم کراودفاندینگ نیست. هدف می شود تزریق روحیه امید در مبتکرین ایرانی است"}]}]}}]),angular.module("uidataModule",["ngResource"]).factory("uidataResource",["$resource","constantsUtils",function($resource,constantsUtils){return $resource(constantsUtils.API_V1_URL+"/UiData/:pageName",{pageName:"@pageName"})}]),angular.module("app.contribute",["ngResource","campaignResourceModule"]),angular.module("app").factory("campaignFactory",["$resource",function($resource){return function(access_token){return $resource(GLOBAL_serverUri+"/api/Campaigns",null,{save:{method:"POST",headers:{Authorization:"Bearer "+access_token,"Content-type":"application/json"}}})}}]).controller("CreateCampaignController",["$scope","$timeout","campaignFactory",function($scope,$timeout,campaignFactory){$scope.createCampaign=function(){if(null==$scope.campaign)return console.log($scope.campaign),$scope.showAlert=!0,void($scope.alertMessage="لطفا اطلاعات بالا را وارد کنید");$scope.isWaiting=!0,new(campaignFactory($scope.access_token).save)($scope.campaign).$promise.then(function(response){console.log("response:"),console.log(response),$scope.showAlert=!0,$scope.success=!0,$scope.isWaiting=!1,$scope.alertMessage="کمپین شما ایجاد شد. جزئیات آن را در صفحه بعدی ویرایش کنید"},function(response){console.log(response),$scope.isWaiting=!1,$scope.showAlert=!0,$scope.alertMessage="مشکلی هنگام ایجاد کمپین به وجود آمده"})}}]),angular.module("campaignDetailsModule",["ngResource","campaignResourceModule"]).controller("CampaignDetailsController",["$scope","$location","$routeParams","$timeout","campaignResource","rewardResource",function($scope,$location,$routeParams,$timeout,campaignResource,rewardResource){$scope.campaignId=$routeParams.campaignId,$scope.campaign=campaignResource($scope.access_token).get({id:$scope.campaignId},function(data){data.hasAccess&&(~data.status.indexOf("Approved")?rewardResource($scope.campaignId).query(function(data){$scope.campaignRewards=data},function(){console.log("failed getting rewards")}):(console.log(data.status),$location.path(["/campaigns/",data.id,"/edit"].join("")).replace()))},function(){console.log("failed getting campaign")}),$scope.getProgressStyle=function(p){return 99<=p?{background:"orange"}:{background:"linear-gradient(135deg,orange,orange "+p/2+"%,white "+(p/2+1)+"%, white "+(100-p/2)+"%, orange "+(100-p/2+1)+"%"}}}]),angular.module("app").directive("campaignTabs",function(){return{restrict:"AE",scope:{campaign:"=",campaignRewards:"=",active:"=",fixedHeight:"="},link:function(scope,element,attrs){scope.$watch("campaign.story",function(i){if(null!=scope.campaign)try{scope.campaign.storyElements=JSON.parse(scope.campaign.story)}catch(e){scope.campaign.storyElements=[{type:"text",text:scope.campaign.story}]}})},templateUrl:"app/components/campaign/details/campaignTabsTemplate"}}),angular.module("editCampaignModule",["campaignResourceModule","uidataModule","ngWig","ngSanitize","ngImgCrop"]),angular.module("campaignResourceModule",["ngResource"]).factory("campaignResource",["$resource","constantsUtils",function($resource,constantsUtils){return function(token){var actions,headers={Authorization:"Bearer "+token};return null!=token&&(actions={get:{method:"GET",headers:headers},save:{method:"POST",headers:headers},query_user_campaigns:{method:"GET",headers:headers,params:{user_campaigns:!0},isArray:!0},soft_delete:{method:"POST",headers:headers,params:{soft_delete:!0},transformRequest:constantsUtils.softDeleteTransform}}),$resource(constantsUtils.API_V1_URL+"/campaigns/:id",{id:"@id"},actions)}}]).factory("rewardResource",["$resource","constantsUtils",function($resource,constantsUtils){return function(campaignId,token){return $resource(constantsUtils.API_V1_URL+"/campaigns/:campaignId/rewards/:rewardId",{campaignId:campaignId,rewardId:"@id"},{save:{method:"POST",headers:{Authorization:"Bearer "+token}},soft_delete:{method:"POST",headers:{Authorization:"Bearer "+token},params:{soft_delete:!0},transformRequest:constantsUtils.softDeleteTransform}},{cancellable:!0})}}]).factory("campaignImageResource",["$resource","constantsUtils",function($resource,constantsUtils){return function(campaignId,token){return $resource(constantsUtils.API_V1_URL+"/campaigns/:campaignId/images/:imageId",{campaignId:campaignId,imageId:"@imageId"},{save:{method:"POST",headers:{Authorization:"Bearer "+token}},update:{method:"POST",headers:{Authorization:"Bearer "+token}}})}}]).factory("campaignDocumentResource",["$resource","constantsUtils",function($resource,constantsUtils){return function(campaignId,token){return $resource(constantsUtils.API_V1_URL+"/documents/campaign/:campaignId/:id",{campaignId:campaignId,id:"@id"},{save:{method:"POST",headers:{Authorization:"Bearer "+token}},update:{method:"POST",headers:{Authorization:"Bearer "+token}},query:{method:"GET",headers:{Authorization:"Bearer "+token},isArray:!0}})}}]).factory("userDocumentResource",["$resource","constantsUtils",function($resource,constantsUtils){return function(userId,token){return $resource(constantsUtils.API_V1_URL+"/documents/user/:userId/:id",{userId:userId,id:"@id"},{save:{method:"POST",headers:{Authorization:"Bearer "+token}},update:{method:"POST",headers:{Authorization:"Bearer "+token}},query:{method:"GET",headers:{Authorization:"Bearer "+token},isArray:!0}})}}]),angular.module("app").directive("rewardTemplate",function(){return{restrict:"AE",scope:{reward:"=",hideRewardImage:"=?",hideNClaimed:"=?"},templateUrl:"app/components/campaign/reward/campaignRewardTemplate"}}),angular.module("app.contribute").directive("paymentButtons",function(){return{template:'<label class="btn btn-default" ng-model="payMethod" uib-btn-radio="\'shetab\'" ng-bind-html="\'_ui_key_PayShetab\' | xlat"></label><label class="btn btn-default" ng-click="openLogin();" ng-model="payMethod" uib-btn-radio="\'mishavad\'"ng-bind-html="\'_ui_key_PayMishavad\' | xlat"></label>'}}).directive("creditButtons",function(){return{template:'<label class="btn btn-success" ng-model="creditType" uib-btn-radio="\'َanonymous\'" uncheckable>دوست دارم<strong>بدون نام</strong>(Anonymous)کمک کنم</label><label class="btn btn-success" ng-model="creditType" uib-btn-radio="\'realname\'" uncheckable><strong> نام واقعی ام</strong>نمایش داده شود</label><label class="btn btn-success" ng-model="creditType" uib-btn-radio="\'nickname\'" uncheckable><strong>نام مستعارم</strong>نمایش داده شود</label>'}}),angular.module("app.contribute").controller("ContributeController",["$scope","$routeParams","$timeout","rewardResource",function($scope,$routeParams,$timeout,rewardResource){console.log($routeParams),$scope.selectedIndex=0,$scope.campaignId=$routeParams.campaignId,rewardResource().query({campaignId:$scope.campaignId},function(data){$scope.campaignRewards=data},function(){console.log("failed")}),$scope.selectReward=function(idx){$scope.contributeOnly="contribute-only"==idx,$scope.contributeOnly?($scope.selectedRewardId=void 0,$scope.giftFundAmount=void 0):$timeout(function(){var selectedReward=$scope.campaignRewards[idx];$scope.selectedRewardId=selectedReward.id,$scope.giftFundAmount=selectedReward.amount},0)},$scope.submitPay=function(){}}]),angular.module("app.contribute").service("paymentService",["$http",function($http){}]),angular.module("editCampaignModule").controller("CampaignBasicController",["$scope","$timeout","$anchorScroll",function($scope,$timeout,$anchorScroll){$scope.$watch("campaignResInstance.province",function(newVal,oldVal){$scope.changeOptionProvince()}),$scope.$watch("campaignProvince",function(newVal,oldVal){$scope.changeOptionProvince()}),$scope.changeOptionProvince=function(){if(null!=$scope.campaignCity&&($scope.campaignCity.availableOptions=[],null!=$scope.campaignResInstance)){angular.forEach($scope.campaignProvince.availableOptions,function(value){value.provinceName==$scope.campaignResInstance.province&&this.push(value)},$scope.campaignCity.availableOptions);var cityBelongsToList=!1;null!=$scope.campaignCity&&(angular.forEach($scope.campaignCity.availableOptions,function(value){value.id!=$scope.campaignResInstance.cityId||(cityBelongsToList=!0)}),cityBelongsToList||($scope.campaignResInstance.cityId=void 0))}},$scope.dropboxitemselected=function(value){$scope.itemselected=value},$scope.addNewTag=function(){var tag=$scope.campaignResInstance._newTag;$scope.tagSubmitted=!0;var p=0;if(""!=tag.trim()){for(var i=0;i<$scope.campaignResInstance.tags.length;i++)$scope.campaignResInstance.tags[i]==tag&&(p=1);0==p&&$scope.campaignResInstance.tags.push(tag)}$scope.campaignResInstance._newTag=""},$scope.populateTags=function(){$scope.campaignResInstance._newTag.trim()},$scope.removeTag=function(id){$scope.campaignResInstance.tags.splice(id,1)},$scope.enterCropThumb=function(){$scope.campaignResInstance.thumbCropMode=!0,$scope.campaignResInstance.cropDataURI=$scope.campaignResInstance.thumbnail},$scope.fileInputLoaded=function(imageData){$scope.campaignResInstance.thumbnail=imageData},$scope.updateCampBasic=function(){if(!$scope.tagSubmitted){if($scope.campBasicWaiting=!0,""!=$scope.campaignResInstance.tagline){var isUpdate=null!=$scope.campaignResInstance.id;$scope.campaignResInstance.$save(function(data){isUpdate?($scope.basicForm.$setPristine(),$scope.setStoryTab()):($scope.pageProps.campaignId=$scope.campaignResInstance.id,$anchorScroll()),$scope.campBasicWaiting=!1},function(data){if($scope.campBasicWaiting=!1,isUpdate)var message="آپدیت موفقیت آمیز نبود. لطفا دوباره سعی کنید";else{console.log(data);message="خطا در ایجاد کمپین"}$scope.alerts.push({type:"danger",msg:message})})}else $scope.submitted=!0;$timeout(function(){$scope.submitted=!1},1e3)}},$scope.$watch("basicForm.$dirty",function(){$scope.dirtyForms.basic.isDirty=$scope.basicForm.$dirty&&null!=$scope.campaignResInstance.id})}]),angular.module("editCampaignModule").controller("CampaignRewardsController",["$scope","rewardResource","$element","$uibModal",function($scope,rewardResource,$element,$uibModal){$scope.$watch("pageProps.uidataLoaded && isLoggedIn && pageProps.campaignId",function(newValue,oldValue){console.log(newValue),newValue&&($scope.RewardRes=rewardResource($scope.pageProps.campaignId,$scope.access_token),$scope.rewardQueryInstance=$scope.RewardRes.query(function(){},function(){$scope.alerts.push({type:"danger",msg:"اتصال برای بارگذاری پاداش ها برقرار نشد لطفا دوباره تلاش کنید."})}))}),$scope.addOrEditReward=function(ind){var parentElem=angular.element($element);null==ind&&(ind=$scope.rewardQueryInstance.push(new $scope.RewardRes({}))-1);var thisRewardInstance=$scope.rewardQueryInstance[ind],modalInstance=$uibModal.open({templateUrl:"app/components/campaign/reward/editRewardTemplate",controller:"EditRewardModalController",appendTo:parentElem,resolve:{reward:function(){return thisRewardInstance}}}),oldReward=angular.copy(thisRewardInstance);console.log(oldReward),modalInstance.result.then(function(){},function(){console.log("dismissed"),$scope.rewardQueryInstance[ind].id?$scope.rewardQueryInstance[ind]=oldReward:$scope.rewardQueryInstance.splice(ind,1)})},$scope.removeReward=function(ind){$scope.rewardQueryInstance[ind].$soft_delete(function(){$scope.rewardQueryInstance.splice(ind,1)},function(){})}}]).controller("EditRewardModalController",["$scope","reward","$uibModalInstance",function($scope,reward,$uibModalInstance){$scope.reward=reward,$scope.submitReward=function(){reward.$save(function(){$uibModalInstance.close()},function(){})},$scope.dismissModal=function(){$uibModalInstance.dismiss()},$scope.$on("$locationChangeStart",function(event){event.preventDefault(),$scope.dismissModal()}),$scope.fileInputLoaded=function(imageData){$scope.reward.newImage=imageData}}]),angular.module("editCampaignModule").controller("CampaignStoryController",["$scope","$timeout","campaignResource","campaignImageResource","$sanitize","$anchorScroll",function($scope,$timeout,campaignResource,campaignImageResource,$sanitize,$anchorScroll){$scope.loadImagesMap=function(){var imagesMap={};angular.forEach($scope.campaignImages,function(img){this[img.id.toString()]=img},imagesMap),$scope.imagesMap=imagesMap},$scope.$watch("campaignId",function(){$scope.pageProps.campaignId&&($scope.CampaignImage=campaignImageResource($scope.pageProps.campaignId,$scope.access_token),$scope.loadCampaignImages())}),$scope.loadCampaignImages=function(){$scope.campaignImages=$scope.CampaignImage.query(function(){$scope.loadImagesMap()})},$scope.getImageByIndex=function(ind){if(console.dir("getImageByIndex:"+ind),$scope.campaignStoryElements){var stElm=$scope.campaignStoryElements[ind];if(stElm){var imgId=stElm.campaignImageId;if(imgId&&$scope.imagesMap){var img=$scope.imagesMap[imgId];if(img)return console.dir("getImageByIndex:"+ind+"filePath:"+img.filePath),img.filePath}}}},$scope.leaveEditMode=function(ind){$scope.campaignStoryElements[ind].editMode=!1},$scope.enterEditMode=function(ind){$scope.campaignStoryElements[ind].editMode=!0},$scope.initializeStElm=function(ind,elmType,imageData){"text"==elmType&&($scope.campaignStoryElements[ind]={editorText:"",text:"",type:"text",editMode:!0}),"image"==elmType&&($scope.campaignStoryElements[ind]={type:"image",editMode:!0,newImage:imageData})},$scope.saveImageEdit=function(ind){var stElm=$scope.campaignStoryElements[ind];stElm.saveWaiting=!0;var imageId=stElm.campaignImageId,campaignImage=$scope.CampaignImage.save({imageId:imageId,base64Image:stElm.imageModel,appendedToStory:null==imageId},function(){stElm.saveWaiting=!1,$scope.loadCampaignImages(),$scope.leaveEditMode(ind),null==imageId?(console.log("Image Uploaded Successfully"),$scope.campaignStoryElements[ind].campaignImageId=campaignImage.id,$scope.addAdjacentEmptyElms(ind),$scope.updateStoryElements()):console.log("Image Updated Successfully")},function(){stElm.saveWaiting=!1})},$scope.saveTextElm=function(ind){var editorText=$sanitize($scope.campaignStoryElements[ind].editorText);if(console.log(editorText),""==editorText.replace(/<\/p>/g,"").replace(/<p>/g,"").replace(/<br>/g,"").replace(/&nbsp;/g,""))$scope.alerts.push({type:"danger",msg:"در ویرایشگر چیزی نوشته نشده است!"});else{var isNewElement=""==($scope.campaignStoryElements[ind].text||"");$scope.campaignStoryElements[ind].text=editorText,$scope.campaignStoryElements[ind].editMode=!1,$scope.updateStoryElements(),isNewElement&&$scope.addAdjacentEmptyElms(ind)}},$scope.emptyStoryElement=function(ind){$scope.campaignStoryElements[ind]={}},$scope.removeStoryElement=function(ind){$scope.campaignStoryElements.splice(ind,2),$scope.updateStoryElements()},$scope.cancelTextEdit=function(ind){""==($scope.campaignStoryElements[ind].text||"")?$scope.emptyStoryElement(ind):($scope.leaveEditMode(ind),$scope.campaignStoryElements[ind].editorText=$scope.campaignStoryElements[ind].text)},$scope.cancelImageEdit=function(ind){null==$scope.campaignStoryElements[ind].campaignImageId?$scope.emptyStoryElement(ind):($scope.campaignStoryElements[ind].newImage=void 0,$scope.leaveEditMode(ind))},$scope.addAdjacentEmptyElms=function(ind){$scope.campaignStoryElements.splice(ind+1,0,{}),$scope.campaignStoryElements.splice(ind,0,{})},$scope.moveElm=function(origin,destination,elmId){var temp=$scope.campaignStoryElements[destination];$scope.campaignStoryElements[destination]=$scope.campaignStoryElements[origin],$scope.campaignStoryElements[origin]=temp,destination<origin&&$timeout(function(){console.log("scroll to elm"+elmId),$anchorScroll.yOffset=120,$anchorScroll("elm"+elmId)},0),$scope.updateStoryElements()},$scope.listElmUp=function(elmIndex,elmId){$scope.moveElm(elmIndex,elmIndex-2,elmId)},$scope.listElmDown=function(elmIndex,elmId){$scope.moveElm(elmIndex,elmIndex+2,elmId)},$scope.fileInputLoaded=function(ind,imageData){$scope.campaignStoryElements[ind].newImage=imageData},$scope.updateStoryElements=function(){for(var elms=$scope.campaignStoryElements,strArray=[],i=0;i<elms.length;i++)elms[i].type&&("image"==elms[i].type?elms[i].campaignImageId&&strArray.push(["[campaignImageId:",elms[i].campaignImageId,"]"].join("")):strArray.push(elms[i].text));$scope.campaignResInstance.story=JSON.stringify(strArray),$scope.waitingAlertInd=$scope.alerts.push({type:"waiting",msg:"در حال آپدیت"})-1,$scope.campaignResInstance.$save().then(function(){$scope.closeAlert($scope.waitingAlertInd)},function(){$scope.closeAlert($scope.waitingAlertInd);var newAlert={type:"danger",msg:"آپدیت موفقیت آمیز نبود. لطفا دوباره سعی کنید",promiseFunc:function(){return $scope.campaignResInstance.$save()}};$scope.alerts.push(newAlert)})},$scope.onPaste=function(e,pasteContent){return pasteContent},$scope.isFirstInitializedSt=function(ind){return 1==ind},$scope.isLastInitializedSt=function(ind){return ind==$scope.campaignStoryElements.length-2}}]),angular.module("editCampaignModule").controller("CampaignUploadDocsController",["$scope","campaignDocumentResource","userDocumentResource",function($scope,campaignDocumentResource,userDocumentResource){$scope.$watch("pageProps.uidataLoaded && isLoggedIn && pageProps.campaignId",function(newValue,oldValue){console.log(newValue),newValue&&($scope.CampaignDocRes=campaignDocumentResource($scope.pageProps.campaignId,$scope.access_token),$scope.campaignDocQueryInstance=$scope.CampaignDocRes.query(function(){},function(){$scope.alerts.push({type:"danger",msg:"اتصال برای بارگذاری مدارک کمپین برقرار نشد لطفا دوباره تلاش کنید."})}),$scope.UserDocRes=userDocumentResource("ThisUser",$scope.access_token),$scope.userDocQueryInstance=$scope.UserDocRes.query(function(){},function(){$scope.alerts.push({type:"danger",msg:"اتصال برای بارگذاری مدارک هویتی برقرار نشد لطفا دوباره تلاش کنید."})}))}),$scope.uploadDoc=function(docType){var queryInstance,Res,newObj;if("campaignDoc"==docType?(queryInstance=$scope.campaignDocQueryInstance,Res=$scope.CampaignDocRes,newObj=$scope.newCampaignDocument):"userDoc"==docType&&(queryInstance=$scope.userDocQueryInstance,Res=$scope.UserDocRes,newObj=$scope.newUserDocument),queryInstance){var ind=queryInstance.push(new Res(newObj))-1;newObj._isWaiting=!0,queryInstance[ind].$save(function(){newObj.description="",newObj._src=void 0,newObj._isWaiting=!1},function(){console.log("Error uploading doc"),queryInstance.splice(ind,1),newObj._isWaiting=!1})}}}]),angular.module("editCampaignModule").controller("EditCampaignController",["$scope","$routeParams","$location","$anchorScroll","$timeout","campaignResource","uidataResource",function($scope,$routeParams,$location,$anchorScroll,$timeout,campaignResource,uidataResource){$scope.alerts=[],$scope.cornerAlerts={},$scope.dirtyForms={basic:{type:"danger",msg:"تغییرات مشخصات کمپین ذخیره نشده اند!",isDirty:!1,isDeselected:!1},story:{type:"danger",msg:"",isDirty:!1,isDeselected:!1}},$scope.closeAlert=function(i){$scope.alerts.splice(i,1)},$scope.closeCornerAlert=function(key){$scope.cornerAlerts[key]=void 0},$scope.tryAgain=function(index,promise){promise&&promise.then(function(){$scope.closeAlert(index)})},$scope.waitingAlertInd=$scope.alerts.push({type:"waiting",msg:"لطفا چند لحظه صبر :)"})-1,$scope.pageProps={activeTab:0,campaignId:$routeParams.campaignId},uidataResource.get({pageName:"EditCampaign"},function(data){$scope.uidata=data,$scope.campaignCity={availableOptions:[]},$scope.campaignProvince={selectProvince:null,availableOptions:$scope.uidata.cities},$scope.campaignType={availableOptions:$scope.uidata.campaignCategories},$scope.campaignLevel={availableOptions:$scope.uidata.projectStages},console.log($scope.campaignResInstance),$scope.pageProps.uidataLoaded=!0},function(data){}),$scope.$watch("pageProps.activeTab",function(){$anchorScroll()}),$scope.$watch("pageProps.uidataLoaded && isLoggedIn",function(){$scope.pageProps.uidataLoaded&&$scope.isLoggedIn&&($scope.campaignStoryElements=[{}],$scope.CampaignRes=campaignResource($scope.access_token),null==$scope.pageProps.campaignId?($scope.newCampaign=!0,$scope.campaignResInstance=new $scope.CampaignRes,$scope.closeAlert($scope.waitingAlertInd)):$scope.campaignResInstance=$scope.CampaignRes.get({id:$scope.pageProps.campaignId},function(data){$scope.campaignResInstance.city=void 0,$scope.extractStoryElements(data),$scope.oldCampaign=angular.copy($scope.campaignResInstance),$scope.closeAlert($scope.waitingAlertInd)},function(data){$scope.closeAlert($scope.waitingAlertInd),$scope.alerts.push({type:"danger",msg:"اتصال برقرار نشد لطفا دوباره تلاش کنید."})}))}),$scope.extractStoryElements=function(data){for(var i=0;i<data.storyElements.length;i++){var stElm=data.storyElements[i].trim(),newElm=void 0;(newElm=/^\[campaignImageId:.*]$/.test(stElm)?{type:"image",editMode:!1,campaignImageId:stElm.replace(/\D+/g,"")}:{type:"text",editMode:!1,text:stElm,editorText:stElm})&&($scope.campaignStoryElements.push(newElm),$scope.campaignStoryElements.push({}))}data.storyElements=void 0},$scope.setStoryTab=function(){$scope.pageProps.activeTab=1},$scope.tabDeselected=function($event,tabName){$scope.dirtyForms[tabName].isDeselected=!0},$scope.tabSelected=function($event,tabName){$scope.dirtyForms[tabName].isDeselected=!1}}]),angular.module("editCampaignModule").directive("editCampaignBasic",function(){return{scope:!0,restrict:"A",templateUrl:"app/components/campaign/edit/editCampaignBasicTemplate",controller:"CampaignBasicController"}}).directive("editCampaignStory",function(){return{scope:!0,restrict:"A",templateUrl:"app/components/campaign/edit/editCampaignStoryTemplate",controller:"CampaignStoryController"}}).directive("editCampaignRewards",function(){return{restrict:"A",templateUrl:"app/components/campaign/edit/editCampaignRewardsTemplate",controller:"CampaignRewardsController"}}).directive("editCampaignUploadDocs",function(){return{restrict:"A",templateUrl:"app/components/campaign/edit/editCampaignUploadDocsTemplate",controller:"CampaignUploadDocsController"}}).directive("docTable",function(){return{restrict:"E",scope:{docs:"="},templateUrl:"app/components/campaign/edit/docTableTemplate"}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$parsers.push(function(val){return parseInt(val,10)}),ngModel.$formatters.push(function(val){return""+val})}}}),angular.module("editCampaignModule").filter("groupBy",["$parse","pmkr.filterStabilize",function($parse,filterStabilize){return filterStabilize(function(input,prop){if(input){var grouped={};return input.forEach(function(item){var key=$parse(prop)(item);grouped[key]=grouped[key]||[],grouped[key].push(item)}),grouped}})}]).factory("pmkr.filterStabilize",["pmkr.memoize",function(memoize){return function(fn){return memoize(function(){var args=[].slice.call(arguments);return args=angular.copy(args),fn.apply(this,args)||args[0]})}}]).factory("pmkr.memoize",[function(){return function(){return function(fn){var cache={};return function(){var args=[].slice.call(arguments),key=JSON.stringify(args);return cache.hasOwnProperty(key)||(cache[key]=fn.apply(this,arguments)),cache[key]}}.apply(this,arguments)}}]),function(){"use strict";var crop=angular.module("ngImgCrop",[]);crop.factory("cropAreaSquare",["cropArea",function(CropArea){var CropAreaSquare=function(){CropArea.apply(this,arguments),this._resizeCtrlBaseRadius=10,this._resizeCtrlNormalRatio=.75,this._resizeCtrlHoverRatio=1,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize={width:0,height:0},this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return(CropAreaSquare.prototype=new CropArea)._calcSquareCorners=function(){var hSize=this._size.height/2,wSize=this._size.width/2;return[[this._x-wSize,this._y-hSize],[this._x+wSize,this._y-hSize],[this._x-wSize,this._y+hSize],[this._x+wSize,this._y+hSize]]},CropAreaSquare.prototype._calcSquareDimensions=function(){var wSize=this._size.width/2,hSize=this._size.height/2;return{left:this._x-wSize,top:this._y-hSize,right:this._x+wSize,bottom:this._y+hSize}},CropAreaSquare.prototype._isCoordWithinArea=function(coord){var squareDimensions=this._calcSquareDimensions();return coord[0]>=squareDimensions.left&&coord[0]<=squareDimensions.right&&coord[1]>=squareDimensions.top&&coord[1]<=squareDimensions.bottom},CropAreaSquare.prototype._isCoordWithinResizeCtrl=function(coord){for(var resizeIconsCenterCoords=this._calcSquareCorners(),res=-1,i=0,len=resizeIconsCenterCoords.length;i<len;i++){var resizeIconCenterCoords=resizeIconsCenterCoords[i];if(coord[0]>resizeIconCenterCoords[0]-this._resizeCtrlHoverRadius&&coord[0]<resizeIconCenterCoords[0]+this._resizeCtrlHoverRadius&&coord[1]>resizeIconCenterCoords[1]-this._resizeCtrlHoverRadius&&coord[1]<resizeIconCenterCoords[1]+this._resizeCtrlHoverRadius){res=i;break}}return res},CropAreaSquare.prototype._drawArea=function(ctx,centerCoords,size){var hSize=size.height/2,wSize=size.width/2;ctx.rect(centerCoords[0]-wSize,centerCoords[1]-hSize,size.width,size.height)},CropAreaSquare.prototype.draw=function(){CropArea.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var resizeIconsCenterCoords=this._calcSquareCorners(),i=0,len=resizeIconsCenterCoords.length;i<len;i++){var resizeIconCenterCoords=resizeIconsCenterCoords[i];this._cropCanvas.drawIconResizeCircle(resizeIconCenterCoords,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},CropAreaSquare.prototype.processMouseMove=function(mouseCurX,mouseCurY){var cursor="default",res=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=mouseCurX-this._posDragStartX,this._y=mouseCurY-this._posDragStartY,cursor="move",res=this._areaIsHover=!0,this._events.trigger("area-move");else if(-1<this._resizeCtrlIsDragging){var xMulti,yMulti;switch(this._resizeCtrlIsDragging){case 0:yMulti=xMulti=-1,cursor="nwse-resize";break;case 1:yMulti=-(xMulti=1),cursor="nesw-resize";break;case 2:xMulti=-1,yMulti=1,cursor="nesw-resize";break;case 3:yMulti=xMulti=1,cursor="nwse-resize"}var iFX=(mouseCurX-this._posResizeStartX)*xMulti,iFY=(mouseCurY-this._posResizeStartY)*yMulti,newSize={width:this._posResizeStartSize.width+iFX,height:this._posResizeStartSize.height+iFY},wasSize=this._size;this.setSize(newSize);var posModifierX=(this._size.width-wasSize.width)/2*xMulti,posModifierY=(this._size.height-wasSize.height)/2*yMulti;this._x+=posModifierX,this._y+=posModifierY,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,res=!0,this._events.trigger("area-resize")}else{var hoveredResizeBox=this._isCoordWithinResizeCtrl([mouseCurX,mouseCurY]);if(-1<hoveredResizeBox){switch(hoveredResizeBox){case 0:cursor="nwse-resize";break;case 1:case 2:cursor="nesw-resize";break;case 3:cursor="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=hoveredResizeBox,res=!0}else this._isCoordWithinArea([mouseCurX,mouseCurY])&&(cursor="move",res=this._areaIsHover=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:cursor}),res},CropAreaSquare.prototype.processMouseDown=function(mouseDownX,mouseDownY){var isWithinResizeCtrl=this._isCoordWithinResizeCtrl([mouseDownX,mouseDownY]);-1<isWithinResizeCtrl?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=isWithinResizeCtrl,this._resizeCtrlIsHover=isWithinResizeCtrl,this._posResizeStartX=mouseDownX,this._posResizeStartY=mouseDownY,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([mouseDownX,mouseDownY])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=mouseDownX-this._x,this._posDragStartY=mouseDownY-this._y,this._events.trigger("area-move-start"))},CropAreaSquare.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),-1<this._resizeCtrlIsDragging&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},CropAreaSquare}]),crop.factory("cropArea",["cropCanvas",function(CropCanvas){var CropArea=function(ctx,events){this._ctx=ctx,this._events=events,this._minSize={width:80,height:40},this._cropCanvas=new CropCanvas(ctx),this._image=new Image,this._x=0,this._y=0,this._size={width:0,height:0}};return CropArea.prototype.getImage=function(){return this._image},CropArea.prototype.setImage=function(image){this._image=image},CropArea.prototype.getX=function(){return this._x},CropArea.prototype.setX=function(x){this._x=x,this._dontDragOutside()},CropArea.prototype.getY=function(){return this._y},CropArea.prototype.setY=function(y){this._y=y,this._dontDragOutside()},CropArea.prototype.getSize=function(){return this._size},CropArea.prototype.setSize=function(size){this._size={width:Math.max(this._minSize.width,size.width),height:Math.max(this._minSize.height,size.height)},this._dontDragOutside()},CropArea.prototype.getMinSize=function(){return this._minSize},CropArea.prototype.setMinSize=function(size){this._minSize=size,this.setSize(this._size)},CropArea.prototype._dontDragOutside=function(){var h=this._ctx.canvas.height,w=this._ctx.canvas.width;this._size.width>w&&(this._size.width=w),this._size.height>h&&(this._size.height=h),this._x<this._size.width/2&&(this._x=this._size.width/2),this._x>w-this._size.width/2&&(this._x=w-this._size.width/2),this._y<this._size.height/2&&(this._y=this._size.height/2),this._y>h-this._size.height/2&&(this._y=h-this._size.height/2)},CropArea.prototype._drawArea=function(){},CropArea.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._size,this._drawArea)},CropArea.prototype.processMouseMove=function(){},CropArea.prototype.processMouseDown=function(){},CropArea.prototype.processMouseUp=function(){},CropArea}]),crop.factory("cropCanvas",[function(){var shapeArrowNW=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],shapeArrowNE=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],shapeArrowSW=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],shapeArrowSE=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],shapeArrowN=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],shapeArrowW=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],shapeArrowS=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],shapeArrowE=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],colors_areaOutline="#fff",colors_resizeBoxStroke="#fff",colors_resizeBoxFill="#444",colors_resizeBoxArrowFill="#fff",colors_resizeCircleStroke="#fff",colors_resizeCircleFill="#444",colors_moveIconFill="#fff";return function(ctx){var calcPoint=function(point,offset,scale){return[scale*point[0]+offset[0],scale*point[1]+offset[1]]},drawFilledPolygon=function(shape,fillStyle,centerCoords,scale){ctx.save(),ctx.fillStyle=fillStyle,ctx.beginPath();var pc,pc0=calcPoint(shape[0],centerCoords,scale);for(var p in ctx.moveTo(pc0[0],pc0[1]),shape)0<p&&(pc=calcPoint(shape[p],centerCoords,scale),ctx.lineTo(pc[0],pc[1]));ctx.lineTo(pc0[0],pc0[1]),ctx.fill(),ctx.closePath(),ctx.restore()};this.drawIconMove=function(centerCoords,scale){drawFilledPolygon(shapeArrowN,colors_moveIconFill,centerCoords,scale),drawFilledPolygon(shapeArrowW,colors_moveIconFill,centerCoords,scale),drawFilledPolygon(shapeArrowS,colors_moveIconFill,centerCoords,scale),drawFilledPolygon(shapeArrowE,colors_moveIconFill,centerCoords,scale)},this.drawIconResizeCircle=function(centerCoords,circleRadius,scale){var scaledCircleRadius=circleRadius*scale;ctx.save(),ctx.strokeStyle=colors_resizeCircleStroke,ctx.lineWidth=2,ctx.fillStyle=colors_resizeCircleFill,ctx.beginPath(),ctx.arc(centerCoords[0],centerCoords[1],scaledCircleRadius,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.restore()},this.drawIconResizeBoxBase=function(centerCoords,boxSize,scale){var scaledBoxSize=boxSize*scale;ctx.save(),ctx.strokeStyle=colors_resizeBoxStroke,ctx.lineWidth=2,ctx.fillStyle=colors_resizeBoxFill,ctx.fillRect(centerCoords[0]-scaledBoxSize,centerCoords[1]-scaledBoxSize,scaledBoxSize,scaledBoxSize),ctx.strokeRect(centerCoords[0]-scaledBoxSize,centerCoords[1]-scaledBoxSize,scaledBoxSize,scaledBoxSize),ctx.restore()},this.drawIconResizeBoxNESW=function(centerCoords,boxSize,scale){this.drawIconResizeBoxBase(centerCoords,boxSize,scale),drawFilledPolygon(shapeArrowNE,colors_resizeBoxArrowFill,centerCoords,scale),drawFilledPolygon(shapeArrowSW,colors_resizeBoxArrowFill,centerCoords,scale)},this.drawIconResizeBoxNWSE=function(centerCoords,boxSize,scale){this.drawIconResizeBoxBase(centerCoords,boxSize,scale),drawFilledPolygon(shapeArrowNW,colors_resizeBoxArrowFill,centerCoords,scale),drawFilledPolygon(shapeArrowSE,colors_resizeBoxArrowFill,centerCoords,scale)},this.drawCropArea=function(image,centerCoords,size,fnDrawClipPath){var xRatio=image.width/ctx.canvas.width,yRatio=image.height/ctx.canvas.height,xLeft=centerCoords[0]-size.width/2,yTop=centerCoords[1]-size.height/2;ctx.save(),ctx.strokeStyle=colors_areaOutline,ctx.lineWidth=2,ctx.beginPath(),fnDrawClipPath(ctx,centerCoords,size),ctx.stroke(),ctx.clip(),0<size.width&&0<size.height&&ctx.drawImage(image,xLeft*xRatio,yTop*yRatio,size.width*xRatio,size.height*yRatio,xLeft,yTop,size.width,size.height),ctx.beginPath(),fnDrawClipPath(ctx,centerCoords,size),ctx.stroke(),ctx.clip(),ctx.restore()}}}]),crop.service("cropEXIF",[function(){var debug=!1,ExifTags=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},TiffTags=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},GPSTags=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},StringValues=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function imageHasData(img){return!!img.exifdata}function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile),iptcdata=function(file){var dataView=new DataView(file);debug&&console.log("Got file of length "+file.byteLength);if(255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return debug&&console.log("Not a valid JPEG"),!1;var offset=2,length=file.byteLength,isFieldSegmentStart=function(dataView,offset){return 56===dataView.getUint8(offset)&&66===dataView.getUint8(offset+1)&&73===dataView.getUint8(offset+2)&&77===dataView.getUint8(offset+3)&&4===dataView.getUint8(offset+4)&&4===dataView.getUint8(offset+5)};for(;offset<length;){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);nameHeaderLength%2!=0&&(nameHeaderLength+=1),0===nameHeaderLength&&(nameHeaderLength=4);var startOffset=offset+8+nameHeaderLength,sectionLength=dataView.getUint16(offset+6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength)}offset++}}(binFile);img.exifdata=data||{},img.iptcdata=iptcdata||{},callback&&callback.call(img)}if(img.src)if(/^data\:/i.test(img.src))handleBinaryFile(function(base64,contentType){contentType=contentType||base64.match(/^data\:([^\;]+)\;base64,/im)[1]||"",base64=base64.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var binary=atob(base64),len=binary.length,buffer=new ArrayBuffer(len),view=new Uint8Array(buffer),i=0;i<len;i++)view[i]=binary.charCodeAt(i);return buffer}(img.src));else if(/^blob\:/i.test(img.src)){(fileReader=new FileReader).onload=function(e){handleBinaryFile(e.target.result)},function(url,callback){var http=new XMLHttpRequest;http.open("GET",url,!0),http.responseType="blob",http.onload=function(e){200!=this.status&&0!==this.status||callback(this.response)},http.send()}(img.src,function(blob){fileReader.readAsArrayBuffer(blob)})}else{var http=new XMLHttpRequest;http.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";handleBinaryFile(http.response),http=null},http.open("GET",img.src,!0),http.responseType="arraybuffer",http.send(null)}else if(window.FileReader&&(img instanceof window.Blob||img instanceof window.File)){var fileReader;(fileReader=new FileReader).onload=function(e){debug&&console.log("Got file of length "+e.target.result.byteLength),handleBinaryFile(e.target.result)},fileReader.readAsArrayBuffer(img)}}function findEXIFinJPEG(file){var dataView=new DataView(file);if(debug&&console.log("Got file of length "+file.byteLength),255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return debug&&console.log("Not a valid JPEG"),!1;for(var marker,offset=2,length=file.byteLength;offset<length;){if(255!=dataView.getUint8(offset))return debug&&console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset)),!1;if(marker=dataView.getUint8(offset+1),debug&&console.log(marker),225==marker)return debug&&console.log("Found 0xFFE1 marker"),readEXIFData(dataView,offset+4,dataView.getUint16(offset+2));offset+=2+dataView.getUint16(offset+2)}}var IptcFieldMap={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function readIPTCData(file,startOffset,sectionLength){for(var fieldValue,fieldName,dataSize,segmentType,dataView=new DataView(file),data={},segmentStartPos=startOffset;segmentStartPos<startOffset+sectionLength;)28===dataView.getUint8(segmentStartPos)&&2===dataView.getUint8(segmentStartPos+1)&&(segmentType=dataView.getUint8(segmentStartPos+2))in IptcFieldMap&&((dataSize=dataView.getInt16(segmentStartPos+3))+5,fieldName=IptcFieldMap[segmentType],fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize),data.hasOwnProperty(fieldName)?data[fieldName]instanceof Array?data[fieldName].push(fieldValue):data[fieldName]=[data[fieldName],fieldValue]:data[fieldName]=fieldValue),segmentStartPos++;return data}function readTags(file,tiffStart,dirStart,strings,bigEnd){var entryOffset,tag,i,entries=file.getUint16(dirStart,!bigEnd),tags={};for(i=0;i<entries;i++)entryOffset=dirStart+12*i+2,!(tag=strings[file.getUint16(entryOffset,!bigEnd)])&&debug&&console.log("Unknown tag: "+file.getUint16(entryOffset,!bigEnd)),tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd);return tags}function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var offset,vals,val,n,numerator,denominator,type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart;switch(type){case 1:case 7:if(1==numValues)return file.getUint8(entryOffset+8,!bigEnd);for(offset=4<numValues?valueOffset:entryOffset+8,vals=[],n=0;n<numValues;n++)vals[n]=file.getUint8(offset+n);return vals;case 2:return getStringFromDB(file,offset=4<numValues?valueOffset:entryOffset+8,numValues-1);case 3:if(1==numValues)return file.getUint16(entryOffset+8,!bigEnd);for(offset=2<numValues?valueOffset:entryOffset+8,vals=[],n=0;n<numValues;n++)vals[n]=file.getUint16(offset+2*n,!bigEnd);return vals;case 4:if(1==numValues)return file.getUint32(entryOffset+8,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);return vals;case 5:if(1==numValues)return numerator=file.getUint32(valueOffset,!bigEnd),denominator=file.getUint32(valueOffset+4,!bigEnd),(val=new Number(numerator/denominator)).numerator=numerator,val.denominator=denominator,val;for(vals=[],n=0;n<numValues;n++)numerator=file.getUint32(valueOffset+8*n,!bigEnd),denominator=file.getUint32(valueOffset+4+8*n,!bigEnd),vals[n]=new Number(numerator/denominator),vals[n].numerator=numerator,vals[n].denominator=denominator;return vals;case 9:if(1==numValues)return file.getInt32(entryOffset+8,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);return vals;case 10:if(1==numValues)return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);return vals}}function getStringFromDB(buffer,start,length){for(var outstr="",n=start;n<start+length;n++)outstr+=String.fromCharCode(buffer.getUint8(n));return outstr}function readEXIFData(file,start){if("Exif"!=getStringFromDB(file,start,4))return debug&&console.log("Not valid EXIF data! "+getStringFromDB(file,start,4)),!1;var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(18761==file.getUint16(tiffOffset))bigEnd=!1;else{if(19789!=file.getUint16(tiffOffset))return debug&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;bigEnd=!0}if(42!=file.getUint16(tiffOffset+2,!bigEnd))return debug&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<8)return debug&&console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd)),!1;if((tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd)).ExifIFDPointer)for(tag in exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd)){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+StringValues.Components[exifData[tag][1]]+StringValues.Components[exifData[tag][2]]+StringValues.Components[exifData[tag][3]]}tags[tag]=exifData[tag]}if(tags.GPSInfoIFDPointer)for(tag in gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd)){switch(tag){case"GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3]}tags[tag]=gpsData[tag]}return tags}this.getData=function(img,callback){return!((img instanceof Image||img instanceof HTMLImageElement)&&!img.complete)&&(imageHasData(img)?callback&&callback.call(img):getImageData(img,callback),!0)},this.getTag=function(img,tag){if(imageHasData(img))return img.exifdata[tag]},this.getAllTags=function(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data)data.hasOwnProperty(a)&&(tags[a]=data[a]);return tags},this.pretty=function(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data)data.hasOwnProperty(a)&&("object"==typeof data[a]?data[a]instanceof Number?strPretty+=a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\r\n":strPretty+=a+" : ["+data[a].length+" values]\r\n":strPretty+=a+" : "+data[a]+"\r\n");return strPretty},this.readFromBinaryFile=function(file){return findEXIFinJPEG(file)}}]),crop.factory("cropHost",["$document","cropAreaSquare","cropEXIF",function($document,CropAreaSquare,cropEXIF){var getElementOffset=function(elem){var box=elem.getBoundingClientRect(),body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)}};return function(elCanvas,opts,events){var ctx=null,image=null,theArea=null,minCanvasDims=[100,100],maxCanvasDims=[300,300],resImgRatio=1.5,resImgFormat="image/png",resImgQuality=null;function drawScene(){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),null!==image&&(ctx.drawImage(image,0,0,ctx.canvas.width,ctx.canvas.height),ctx.save(),ctx.fillStyle="rgba(0, 0, 0, 0.65)",ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.restore(),theArea.draw())}var resetCropHost=function(){if(null!==image){theArea.setImage(image);image.width,image.height,image.width,image.height;updateCanvasDims(),theArea.setX(ctx.canvas.width/2),theArea.setY(ctx.canvas.height/2),theArea.setSize({width:Math.min(200,ctx.canvas.width/2),height:Math.min(200,ctx.canvas.height/2)})}else elCanvas.prop("width",0).prop("height",0).css({"margin-top":0});drawScene()},updateCanvasDims=function(){var imageDims=[image.width,image.height],imageRatio=image.width/image.height,canvasDims=imageDims;canvasDims[0]>maxCanvasDims[0]?(canvasDims[0]=maxCanvasDims[0],canvasDims[1]=canvasDims[0]/imageRatio):canvasDims[0]<minCanvasDims[0]&&(canvasDims[0]=minCanvasDims[0],canvasDims[1]=canvasDims[0]/imageRatio),angular.isDefined(maxCanvasDims[1])&&(canvasDims[1]>maxCanvasDims[1]?(canvasDims[1]=maxCanvasDims[1],canvasDims[0]=canvasDims[1]*imageRatio):canvasDims[1]<minCanvasDims[1]&&(canvasDims[1]=minCanvasDims[1],canvasDims[0]=canvasDims[1]*imageRatio)),elCanvas.prop("width",canvasDims[0]).prop("height",canvasDims[1])},getChangedTouches=function(event){return angular.isDefined(event.changedTouches)?event.changedTouches:event.originalEvent.changedTouches},onMouseMove=function(e){if(null!==image){var pageX,pageY,offset=getElementOffset(ctx.canvas);"touchmove"===e.type?(pageX=getChangedTouches(e)[0].pageX,pageY=getChangedTouches(e)[0].pageY):(pageX=e.pageX,pageY=e.pageY),theArea.processMouseMove(pageX-offset.left,pageY-offset.top),drawScene()}},onMouseDown=function(e){if(e.preventDefault(),e.stopPropagation(),null!==image){var pageX,pageY,offset=getElementOffset(ctx.canvas);"touchstart"===e.type?(pageX=getChangedTouches(e)[0].pageX,pageY=getChangedTouches(e)[0].pageY):(pageX=e.pageX,pageY=e.pageY),theArea.processMouseDown(pageX-offset.left,pageY-offset.top),drawScene()}},onMouseUp=function(e){if(null!==image){var pageX,pageY,offset=getElementOffset(ctx.canvas);"touchend"===e.type?(pageX=getChangedTouches(e)[0].pageX,pageY=getChangedTouches(e)[0].pageY):(pageX=e.pageX,pageY=e.pageY),theArea.processMouseUp(pageX-offset.left,pageY-offset.top),drawScene()}};this.getResultImageDataURI=function(){if(null!=image){var temp_ctx,temp_canvas;temp_ctx=(temp_canvas=angular.element("<canvas></canvas>")[0]).getContext("2d");var area_size=theArea.getSize(),w=area_size.width,h=area_size.height;return temp_canvas.width=resImgRatio*w,temp_canvas.height=resImgRatio*h,null!==image&&temp_ctx.drawImage(image,(theArea.getX()-w/2)*(image.width/ctx.canvas.width),(theArea.getY()-h/2)*(image.height/ctx.canvas.height),w*(image.width/ctx.canvas.width),h*(image.height/ctx.canvas.height),0,0,temp_canvas.width,temp_canvas.height),null!==resImgQuality?temp_canvas.toDataURL(resImgFormat,resImgQuality):temp_canvas.toDataURL(resImgFormat)}},this.setNewImageSource=function(imageSource){if(image=null,resetCropHost(),events.trigger("image-updated"),imageSource){var newImage=new Image;"http"===imageSource.substring(0,4).toLowerCase()&&(newImage.crossOrigin="anonymous"),newImage.onload=function(){events.trigger("load-done"),cropEXIF.getData(newImage,function(){var orientation=cropEXIF.getTag(newImage,"Orientation");if(-1<[3,6,8].indexOf(orientation)){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),cw=newImage.width,ch=newImage.height,cx=0,cy=0,deg=0;switch(orientation){case 3:cx=-newImage.width,cy=-newImage.height,deg=180;break;case 6:cw=newImage.height,ch=newImage.width,cy=-newImage.height,deg=90;break;case 8:cw=newImage.height,ch=newImage.width,cx=-newImage.width,deg=270}canvas.width=cw,canvas.height=ch,ctx.rotate(deg*Math.PI/180),ctx.drawImage(newImage,cx,cy),(image=new Image).src=canvas.toDataURL("image/png")}else image=newImage;resetCropHost(),events.trigger("image-updated")})},newImage.onerror=function(){events.trigger("load-error")},events.trigger("load-start"),newImage.src=imageSource}},this.setMaxDimensions=function(width,height){if(maxCanvasDims=[width,height],null!==image){var curWidth=ctx.canvas.width,curHeight=ctx.canvas.height;updateCanvasDims();var ratioNewCurWidth=ctx.canvas.width/curWidth,ratioNewCurHeight=ctx.canvas.height/curHeight;theArea.setX(theArea.getX()*ratioNewCurWidth),theArea.setY(theArea.getY()*ratioNewCurHeight);var area_size=theArea.getSize();theArea.setSize({width:area_size.width*ratioNewCurWidth,height:area_size.height*ratioNewCurHeight})}else elCanvas.prop("width",0).prop("height",0).css({"margin-top":0});drawScene()},this.setAreaMinSize=function(size){size&&(theArea.setMinSize(size),drawScene())},this.setResultImageRatio=function(r){null!=r&&(resImgRatio=r)},this.setResultImageFormat=function(format){resImgFormat=format},this.setResultImageQuality=function(quality){quality=parseFloat(quality),!isNaN(quality)&&0<=quality&&quality<=1&&(resImgQuality=quality)},ctx=elCanvas[0].getContext("2d"),theArea=new CropAreaSquare(ctx,events),$document.on("mousemove",onMouseMove),elCanvas.on("mousedown",onMouseDown),$document.on("mouseup",onMouseUp),$document.on("touchmove",onMouseMove),elCanvas.on("touchstart",onMouseDown),$document.on("touchend",onMouseUp),this.destroy=function(){$document.off("mousemove",onMouseMove),elCanvas.off("mousedown",onMouseDown),$document.off("mouseup",onMouseMove),$document.off("touchmove",onMouseMove),elCanvas.off("touchstart",onMouseDown),$document.off("touchend",onMouseMove),elCanvas.remove()}}}]),crop.factory("cropPubSub",[function(){return function(){var events={};this.on=function(names,handler){return names.split(" ").forEach(function(name){events[name]||(events[name]=[]),events[name].push(handler)}),this},this.trigger=function(name,args){return angular.forEach(events[name],function(handler){handler.call(null,args)}),this}}}]),crop.directive("imgCrop",["$timeout","cropHost","cropPubSub",function($timeout,CropHost,CropPubSub){return{restrict:"AE",scope:{image:"=?",resultImage:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageRatio:"=",resultImageFormat:"@",resultImageQuality:"=",maxHeight:"=?",maxWidth:"=?",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function($scope){$scope.events=new CropPubSub}],link:function(scope,element){var storedResultImage,events=scope.events,cropHost=new CropHost(element.find("canvas"),{},events),updateResultImage=function(scope){var resultImage=cropHost.getResultImageDataURI();storedResultImage!==resultImage&&(storedResultImage=resultImage,scope.resultImage=resultImage,scope.onChange({$dataURI:scope.resultImage}))},fnSafeApply=function(fn){return function(){$timeout(function(){scope.$apply(function(scope){fn(scope)})})}};events.on("load-start",fnSafeApply(function(scope){scope.onLoadBegin({})})).on("load-done",fnSafeApply(function(scope){scope.onLoadDone({})})).on("load-error",fnSafeApply(function(scope){scope.onLoadError({})})).on("area-move area-resize",fnSafeApply(function(scope){scope.changeOnFly&&updateResultImage(scope)})).on("area-move-end area-resize-end image-updated",fnSafeApply(function(scope){updateResultImage(scope)})),scope.$watch("image",function(){cropHost.setNewImageSource(scope.image)}),scope.$watch("areaMinSize",function(){cropHost.setAreaMinSize(scope.areaMinSize),updateResultImage(scope)}),scope.$watch("resultImageRatio",function(){cropHost.setResultImageRatio(scope.resultImageRatio),updateResultImage(scope)}),scope.$watch("resultImageFormat",function(){cropHost.setResultImageFormat(scope.resultImageFormat),updateResultImage(scope)}),scope.$watch("resultImageQuality",function(){cropHost.setResultImageQuality(scope.resultImageQuality),updateResultImage(scope)}),scope.$watch("[maxWidth, maxHeight]",function(value){var wmax=angular.isDefined(value[0])?Math.min(value[0],element[0].clientWidth):element[0].clientWidth;cropHost.setMaxDimensions(wmax,value[1]),updateResultImage(scope)}),scope.$watch(function(){return element[0].clientWidth},function(value){if(0!=value){var wmax=angular.isDefined(scope.maxWidth)?Math.min(value,scope.maxWidth):value;cropHost.setMaxDimensions(wmax,scope.maxHeight),updateResultImage(scope)}},!0),scope.$on("$destroy",function(){cropHost.destroy()})}}}]).directive("imgFileInput",["$timeout","$document",function($timeout,$document){return{restrict:"A",scope:{fileInputLoaded:"&"},link:function(scope,element,attrs){angular.element(element[0]).on("change",function(evt){var file=evt.currentTarget.files[0],reader=new FileReader;reader.onload=function(evt){scope.$apply(function(scope){scope.fileInputLoaded({imageData:evt.target.result})})},reader.readAsDataURL(file)})}}}]).directive("imgDims",["$timeout","$document",function($timeout,$document){return{restrict:"AE",scope:{imageWidth:"=",imageHeight:"=",imgSrc:"="},link:function(scope,element,attrs){element[0].onload=function(){var w=this.width,h=this.height;scope.$apply(function(scope){scope.imageWidth=w,scope.imageHeight=h})},scope.$watch("imgSrc",function(newVal){element[0].src=scope.imgSrc})}}}])}()}(angular);